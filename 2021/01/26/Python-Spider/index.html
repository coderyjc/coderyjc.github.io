<!DOCTYPE html>
<html lang="en">
    
    <head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" name="viewport" />
    <meta name="description" content="ç¬”è®° | Pythonçˆ¬è™«" />
    <meta name="hexo-theme-A4" content="v1.9.6" />
    <link rel="alternate icon" type="image/webp" href="/img/avatar.png">
    <title>Jingcun Yan</title>

    
        
<link rel="stylesheet" href="/css/highlight/style1.css">

        
<link rel="stylesheet" href="/css/reset.css">

        
<link rel="stylesheet" href="/css/markdown.css">

        
<link rel="stylesheet" href="/css/fonts.css">
 
         <!--æ³¨æ„ï¼šé¦–é¡µæ—¢ä¸æ˜¯postä¹Ÿä¸æ˜¯page-->
        
        
        
<link rel="stylesheet" href="/css/ui.css">
 
        
<link rel="stylesheet" href="/css/style.css">


        
            <!--è¿”å›é¡¶éƒ¨css-->
            
<link rel="stylesheet" href="/css/returnToTop.css">

            
<link rel="stylesheet" href="/css/unicons.css">

        
        
            <!--ç›®å½•-->
            
<link rel="stylesheet" href="/css/toc.css">

        
    

    
        
<link rel="stylesheet" href="/css/returnToLastPage.css">

    
    
   
<link rel="stylesheet" href="/css/lightgallery-bundle.min.css">


<meta name="generator" content="Hexo 7.3.0"></head>
    
    
        <style>
            .index-main{
                max-width:  880px;
            }
        </style>

    
    



    

    
    

    
    
    
    <body>
        <script src="/js/darkmode-js.min.js"></script>
        
        <script>
            const options = {
                bottom: '40px', // default: '32px'
                right: 'unset', // default: '32px'
                left: '42px', // default: 'unset'
                time: '0.3s', // default: '0.3s'
                mixColor: '#fff', // default: '#fff'
                backgroundColor: ' #e4e4e4 ',  // default: '#fff'
                buttonColorDark: '#100f2c',  // default: '#100f2c'
                buttonColorLight: '#fff', // default: '#fff'
                saveInCookies: true, // default: true,
                label: 'ğŸŒ“', // default: ''
                autoMatchOsTheme: true // default: true
            }
            const darkmode = new Darkmode(options);
            darkmode.showWidget();
        </script>
        
        
            <div class="left-toc-container">
                <nav id="toc" class="bs-docs-sidebar"></nav>
            </div>
        
        <div class="paper">
            
            
            
            
                <div class="shadow-drop-2-bottom paper-main">
                    


<div class="header">
    <div class="header-container">
        <img style="
        width: 56px;
        height: auto;" alt="^-^" cache-control="max-age=86400" class="header-img" src="/img/avatar.png" width="10%"></img>
        <div class="header-content">
            <a class="logo" href="/">Jingcun Yan</a> 
            <span class="description"></span> 
        </div>
        
    </div>
    
   
    <ul class="nav">
        
            
                <li><a href="/">é¦–é¡µ</a></li>
            
        
            
                <li><a href="/list/">æ–‡ç« </a></li>
            
        
            
                <li><a href="/collect/">æ”¶è—</a></li>
            
        
    </ul>
</div> 
        
                    
                    

                    
                    
                    
                    <!--è¯´æ˜æ˜¯æ–‡ç« posté¡µé¢-->
                    
                        <div class="post-main">
    

    
        
            
                <div class="post-main-title" style="text-align: center;">
                    ç¬”è®° | Pythonçˆ¬è™«
                </div>
            
        
      
    

    

        
            <div class="post-head-meta-center">
        
                
                
                    
                     <span>å­—æ•°æ€»è®¡ï¼š8.7k</span>
                
                
                    
                        &nbsp; | &nbsp;
                    
                    <span>é˜…è¯»ä¼°æ—¶ï¼š35åˆ†é’Ÿ</span>
                
                
            </div>
    

    <div class="post-md">
        
        <div class=".article-gallery"><h1 id="Pythonçˆ¬è™«"><a href="#Pythonçˆ¬è™«" class="headerlink" title="Pythonçˆ¬è™«"></a>Pythonçˆ¬è™«</h1><blockquote>
<p><a target="_blank" rel="noopener" href="https://book.apeland.cn/details/66/">å­¦ä¹ æ–‡æ¡£(https://book.apeland.cn/details/66/)</a></p>
</blockquote>
<h2 id="çˆ¬è™«åŸºç¡€ç®€ä»‹"><a href="#çˆ¬è™«åŸºç¡€ç®€ä»‹" class="headerlink" title="çˆ¬è™«åŸºç¡€ç®€ä»‹"></a>çˆ¬è™«åŸºç¡€ç®€ä»‹</h2><p>çˆ¬è™«åœ¨ä½¿ç”¨åœºæ™¯ä¸­çš„åˆ†ç±»</p>
<ul>
<li>é€šç”¨çˆ¬è™«ï¼šæŠ“å–ç³»ç»Ÿé‡è¦ç»„æˆéƒ¨åˆ†ã€‚æŠ“å–çš„æ˜¯ä¸€æ•´å¼ é¡µé¢æ•°æ®ã€‚</li>
<li>èšç„¦çˆ¬è™«ï¼šæ˜¯å»ºç«‹åœ¨é€šç”¨çˆ¬è™«çš„åŸºç¡€ä¹‹ä¸Šã€‚æŠ“å–çš„æ˜¯é¡µé¢ä¸­ç‰¹å®šçš„å±€éƒ¨å†…å®¹ã€‚</li>
<li>å¢é‡å¼çˆ¬è™«ï¼šæ£€æµ‹ç½‘ç«™ä¸­æ•°æ®æ›´æ–°çš„æƒ…å†µã€‚åªä¼šæŠ“å–ç½‘ç«™ä¸­æœ€æ–°æ›´æ–°å‡ºæ¥çš„æ•°æ®ã€‚</li>
</ul>
<p>robots.txt è§„å®šäº†å“ªäº›æ•°æ®å¯ä»¥è¢«çˆ¬å–ï¼Œå“ªäº›ä¸èƒ½çˆ¬å–</p>
<p>httpåè®®ï¼šå°±æ˜¯æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯è¿›è¡Œæ•°æ®äº¤äº’çš„ä¸€ç§å½¢å¼ã€‚</p>
<p>å¸¸ç”¨è¯·æ±‚å¤´ä¿¡æ¯</p>
<ul>
<li>User-Agentï¼šè¯·æ±‚è½½ä½“çš„èº«ä»½æ ‡è¯†</li>
<li>Connectionï¼šè¯·æ±‚å®Œæ¯•åï¼Œæ˜¯æ–­å¼€è¿æ¥è¿˜æ˜¯ä¿æŒè¿æ¥å¸¸ç”¨å“åº”å¤´ä¿¡æ¯</li>
</ul>
<p>å¸¸ç”¨çš„å“åº”å¤´æ¶ˆæ¯</p>
<ul>
<li>Content-Typeï¼šæœåŠ¡å™¨å“åº”å›å®¢æˆ·ç«¯çš„æ•°æ®ç±»å‹</li>
</ul>
<p>httpsåè®®ï¼šå®‰å…¨çš„è¶…æ–‡æœ¬ä¼ è¾“åè®® - ä¼ è¾“çš„æ–‡æœ¬è¿›è¡Œäº†åŠ å¯†</p>
<p>åŠ å¯†æ–¹å¼ï¼š</p>
<ul>
<li>å¯¹ç§°å¯†é’¥åŠ å¯†<ul>
<li>â€œå…±äº«å¯†é’¥åŠ å¯†â€ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®¢æˆ·ç«¯å°†æ–‡ä»¶åŠ å¯†ä¹‹åï¼Œå°†å¯†é’¥å’ŒåŠ å¯†åçš„ä¿¡æ¯ä¸€èµ·ä¼ é€ç»™æœåŠ¡ç«¯ï¼ŒåŠ å¯†å’Œè§£å¯†çš„å¯†é’¥æ˜¯åŒä¸€ä¸ªï¼Œè¿™ç§æ–¹å¼çœ‹èµ·æ¥å®‰å…¨ï¼Œä½†æ˜¯ä»ç„¶æœ‰å®‰å…¨éšæ‚£ã€‚</li>
</ul>
</li>
<li>éå¯¹ç§°å¯†é’¥åŠ å¯†<ul>
<li>æœåŠ¡ç«¯åˆ¶é€ å¯†é’¥å¯¹ï¼ˆå…¬é’¥-&gt;ç”¨æ¥åŠ å¯† å’Œ ç§é’¥-&gt;ç”¨æ¥è§£å¯†ï¼‰ï¼Œå°†å…¬é’¥å‘é€ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯ä½¿ç”¨å…¬é’¥åŠ å¯†æ–‡ä»¶ï¼Œå°†åŠ å¯†åçš„æ–‡ä»¶å‘é€ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯ç”¨ç§é’¥è¿›è¡Œè§£å¯†ã€‚</li>
<li>æŠ€æœ¯éš¾é¢˜ï¼ˆç¼ºç‚¹ï¼‰ï¼šä¿è¯æ¥æ”¶ç«¯å‘å‘é€ç«¯å‘å‡ºå…¬å¼€ç§˜é’¥çš„æ—¶å€™ï¼Œå‘é€ç«¯ç¡®ä¿æ”¶åˆ°çš„æ˜¯é¢„å…ˆè¦å‘é€çš„ï¼Œè€Œä¸ä¼šè¢«æŒŸæŒã€‚æ•ˆç‡ä½ï¼Œå¤„ç†å¤æ‚ï¼Œå½±å“é€šä¿¡é€Ÿåº¦</li>
</ul>
</li>
<li>è¯ä¹¦å¯†é’¥åŠ å¯†</li>
</ul>
<h2 id="requestsæ¨¡å—åŸºç¡€"><a href="#requestsæ¨¡å—åŸºç¡€" class="headerlink" title="requestsæ¨¡å—åŸºç¡€"></a>requestsæ¨¡å—åŸºç¡€</h2><p>æ­¥éª¤</p>
<ul>
<li>æŒ‡å®šurl - <strong>è¿™ä¸ªurlä¸€å®šæ˜¯é€šè¿‡æŠ“åŒ…è·å–çš„ï¼Œç›´æ¥è¾“å…¥åœ°å€æ å¯èƒ½ä¸ä¼šè¾¾åˆ°é¢„æœŸçš„ç»“æœ</strong></li>
<li>å‘èµ·è¯·æ±‚</li>
<li>è·å–å“åº”æ•°æ®</li>
<li>æŒä¹…åŒ–å­˜å‚¨</li>
</ul>
<p>çˆ¬å–æœç‹—é¡µé¢çš„æ•°æ®ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># æŒ‡å®šurlï¼ˆé€šè¿‡æŠ“åŒ…è·å–ï¼‰</span></span><br><span class="line">    url = <span class="string">&quot;http://www.kekenet.com/&quot;</span>;</span><br><span class="line">    <span class="comment"># å‘èµ·è¯·æ±‚</span></span><br><span class="line">    responce = requests.get(url = url);</span><br><span class="line">    <span class="comment"># è®¾ç½®å­—ç¬¦ç¼–ç </span></span><br><span class="line">    responce.encoding = <span class="string">&#x27;utf-8&#x27;</span></span><br><span class="line">    <span class="comment"># è·å–å“åº”æ•°æ®</span></span><br><span class="line">    page_text = responce.text</span><br><span class="line">    <span class="comment"># æŒä¹…åŒ–å­˜å‚¨</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;baidu.txt&quot;</span>, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">        fp.write(page_text);</span><br><span class="line">        fp.close()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Success!&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="UAä¼ªè£…"><a href="#UAä¼ªè£…" class="headerlink" title="UAä¼ªè£…"></a>UAä¼ªè£…</h3><p>åçˆ¬æœºåˆ¶</p>
<ul>
<li>User-Agentï¼šè¯·æ±‚è½½ä½“çš„èº«ä»½æ ‡è¯†ï¼Œä½¿ç”¨æµè§ˆå™¨å‘èµ·çš„è¯·æ±‚ï¼Œè¯·æ±‚è½½ä½“çš„èº«ä»½æ ‡è¯†ä¸ºæµè§ˆå™¨ï¼Œä½¿ç”¨çˆ¬è™«ç¨‹åºå‘èµ·çš„è¯·æ±‚ï¼Œè¯·æ±‚è½½ä½“ä¸ºçˆ¬è™«ç¨‹åºã€‚</li>
<li>UAæ£€æµ‹ï¼šç›¸å…³çš„é—¨æˆ·ç½‘ç«™é€šè¿‡æ£€æµ‹è¯·æ±‚è¯¥ç½‘ç«™çš„è½½ä½“èº«ä»½æ¥è¾¨åˆ«è¯¥è¯·æ±‚æ˜¯å¦ä¸ºçˆ¬è™«ç¨‹åºï¼Œå¦‚æœæ˜¯ï¼Œåˆ™ç½‘ç«™æ•°æ®è¯·æ±‚å¤±è´¥ã€‚å› ä¸ºæ­£å¸¸ç”¨æˆ·å¯¹ç½‘ç«™å‘èµ·çš„è¯·æ±‚çš„è½½ä½“ä¸€å®šæ˜¯åŸºäºæŸä¸€æ¬¾æµè§ˆå™¨ï¼Œå¦‚æœç½‘ç«™æ£€æµ‹åˆ°æŸä¸€è¯·æ±‚è½½ä½“èº«ä»½æ ‡è¯†ä¸æ˜¯åŸºäºæµè§ˆå™¨çš„ï¼Œåˆ™è®©å…¶è¯·æ±‚å¤±è´¥ã€‚å› æ­¤ï¼ŒUAæ£€æµ‹æ˜¯æˆ‘ä»¬æ•´ä¸ªè¯¾ç¨‹ä¸­é‡åˆ°çš„ç¬¬äºŒç§åçˆ¬æœºåˆ¶ï¼Œç¬¬ä¸€ç§æ˜¯robotsåè®®</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    url = <span class="string">&#x27;https://www.sogou.com/web&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># è¯·æ±‚å¤´ï¼Œé‡Œé¢è®¾ç½®æˆ‘ä»¬çš„UA</span></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Linux; Nexus 5 Build/MRA58N) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.66 Safari/537.36&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># å¤„ç†urlä¸­æºå¸¦çš„å‚æ•°-å°è£…åˆ°å­—å…¸ä¸­</span></span><br><span class="line">    kw = <span class="built_in">input</span>(<span class="string">&#x27;enter a keyword :&#x27;</span>)</span><br><span class="line">    <span class="comment"># è¯·æ±‚ä¸­çš„å‚æ•°</span></span><br><span class="line">    param = &#123;</span><br><span class="line">        <span class="string">&#x27;query&#x27;</span>: kw</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># urlæ˜¯æºå¸¦å‚æ•°çš„ï¼Œå¹¶ä¸”è¯·æ±‚è¿‡ç¨‹ä¸­å¤„ç†äº†å‚æ•°</span></span><br><span class="line">    response = requests.get(url=url, params=param, headers=headers)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¦‚æœé¡µé¢æ˜¾ç¤ºä¹±ç ï¼Œå¯ä»¥åŠ ä¸Šè¿™ä¸€å¥</span></span><br><span class="line">    <span class="comment"># response.encoding = &#x27;utf-8&#x27;</span></span><br><span class="line"></span><br><span class="line">    page_text = response.text</span><br><span class="line">    <span class="comment"># æŒä¹…åŒ–å­˜å‚¨</span></span><br><span class="line">    fileName = kw + <span class="string">&#x27;.html&#x27;</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(fileName, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">        fp.write(page_text)</span><br><span class="line">        fp.close()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;success&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="çˆ¬å–å±€éƒ¨ä¿¡æ¯ï¼ˆajax-postï¼‰"><a href="#çˆ¬å–å±€éƒ¨ä¿¡æ¯ï¼ˆajax-postï¼‰" class="headerlink" title="çˆ¬å–å±€éƒ¨ä¿¡æ¯ï¼ˆajax-postï¼‰"></a>çˆ¬å–å±€éƒ¨ä¿¡æ¯ï¼ˆajax-postï¼‰</h3><p>æˆ‘ä»¬å·²ç»çŸ¥é“ï¼Œç™¾åº¦ç¿»è¯‘çš„å•è¯ç¿»è¯‘åŒºæ˜¯åŸºäºajaxçš„å±€éƒ¨åˆ·æ–°å®ç°çš„</p>
<p>![[img&#x2F;image-20210126171017846.png]]<br>å› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡æŠ“åŒ…å·¥å…·æ¥è·å–å‘é€è¿‡æ¥çš„æ•°æ®ã€‚</p>
<p>![[img&#x2F;image-20210126171319186.png]]<br>ä»ä¸‹æ–¹æ•°æ®åŒ…ä¸­æ‰¾åˆ°æˆ‘ä»¬éœ€è¦çš„dogæœ‰å…³çš„jsonæ•°æ®ï¼Œå¯ä»¥å‘ç°ï¼Œæˆ‘ä»¬å‘é€çš„è¡¨å•æ•°æ®ä¸º kw:â€dogâ€ï¼Œå› æ­¤æˆ‘ä»¬çš„è¡¨å•éœ€è¦ä¸€ä¸ªkwå±æ€§çš„æ•°æ®ï¼Œå€¼ä¸ºæˆ‘ä»¬è¦æŸ¥æ‰¾çš„æ•°æ®ã€‚</p>
<p>![[img&#x2F;image-20210126171500291.png]]<br>æŸ¥çœ‹å“åº”ï¼Œå‘ç°é‡Œé¢å°è£…çš„jsonæ•°æ®åˆšå¥½æ˜¯æˆ‘ä»¬éœ€è¦çš„ã€‚</p>
<p>![[img&#x2F;image-20210126171619847.png]]</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># è·å–ç”¨æˆ·è¾“å…¥çš„å…³é”®è¯</span></span><br><span class="line">    keyWord = <span class="built_in">input</span>(<span class="string">&quot;enter a word to search: &quot;</span>)</span><br><span class="line">    <span class="comment"># è®¾ç½®UA</span></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/69.0.3497.100 Safari/537.36&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># è®¾ç½®url</span></span><br><span class="line">    url = <span class="string">&quot;https://fanyi.baidu.com/sug&quot;</span></span><br><span class="line">    <span class="comment"># å°†è¦å‘é€çš„æ•°æ®</span></span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;kw&quot;</span>: keyWord</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># è·å–å›åº”çš„æ•°æ®</span></span><br><span class="line">    response = requests.post(url=url, data=data, headers=headers)</span><br><span class="line">    <span class="comment"># å°†å›åº”çš„æ•°æ®è½¬åŒ–ä¸ºjsonæ ¼å¼</span></span><br><span class="line">    json_data = response.json()</span><br><span class="line">    <span class="comment"># æ•°æ®çš„æŒä¹…åŒ–å­˜å‚¨</span></span><br><span class="line">    fileName = keyWord + <span class="string">&#x27;.json&#x27;</span></span><br><span class="line">    fp = <span class="built_in">open</span>(fileName, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    json.dump(json_data, fp, ensure_ascii=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ‰©å±•ï¼šjsonæ•°æ®æ ¼å¼ä¸python</p>
<p>å°†python çš„æ•°æ®ç»“æ„è½¬æ¢ä¸ºjsonï¼š<code>json_str = json.dumps(data)</code> å…¶ä¸­ï¼Œdataæ˜¯ä¸€ä¸ªjsonæ ¼å¼çš„å­—å…¸ç±»å‹æ•°æ®; å°†jsonç¼–ç çš„å­—ç¬¦ä¸²è½¬åŒ–ä¸ºpythonæ ¼å¼<code>data = json.loads(json_str)</code></p>
<p>å¦‚æœå¤„ç†çš„æ˜¯æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨dumpä¸lodaç¼–ç å’Œè§£æjsonæ•°æ®ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Writing JSON data</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;data.json&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    json.dump(data, f)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Reading data back</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;data.json&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    data = json.load(f)</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="çˆ¬å–å±€éƒ¨ä¿¡æ¯ï¼ˆajax-getï¼‰"><a href="#çˆ¬å–å±€éƒ¨ä¿¡æ¯ï¼ˆajax-getï¼‰" class="headerlink" title="çˆ¬å–å±€éƒ¨ä¿¡æ¯ï¼ˆajax-getï¼‰"></a>çˆ¬å–å±€éƒ¨ä¿¡æ¯ï¼ˆajax-getï¼‰</h3><p>æˆ‘ä»¬æ¥åˆ° <a target="_blank" rel="noopener" href="https://movie.douban.com/typerank?type_name=%E5%8A%A8%E4%BD%9C&type=5&interval_id=100:90&action=">è±†ç“£åŠ¨ä½œç”µå½±åˆ†ç±»æ’è¡Œæ¦œ</a> å‘ç°åœ¨å°†é¡µé¢ä¸‹æ‹‰åˆ°æœ€åº•éƒ¨çš„æ—¶å€™ä¼šåˆ·æ–°å‡ºæ¥ç”±æ­¤æˆ‘ä»¬å¯ä»¥åˆ¤å®šæ˜¯ajaxåŠ¨æ€åˆ·æ–°é¡µé¢ï¼Œæ‰“å¼€æµè§ˆå™¨è‡ªå¸¦çš„æŠ“åŒ…å·¥å…·ï¼Œè¿‡æ»¤xhrè¯·æ±‚ï¼Œå°†é¡µé¢ä¸‹æ‹‰åˆ°æœ€ä¸‹é¢ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥æ•è·åˆ°åˆ·æ–°å‡ºæ¥çš„æ–°çš„æ•°æ®çš„ä¿¡æ¯ã€‚</p>
<p>![[img&#x2F;image-20210126175023398.png]]<br>åœ¨ä¸‹æ‹‰åˆ°æ—¶å€™æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å‡ºç°è¿™ä¹ˆä¸€æ¡ä¿¡æ¯ï¼Œæ¶ˆæ¯å¤´æ˜¯getæ–¹å¼ï¼Œé“¾æ¥ä¸º<code>https://movie.douban.com/j/chart/top_list?type=5&amp;interval_id=100:90&amp;action=&amp;start=20&amp;limit=20</code></p>
<p>å› æ­¤æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹è¿™ä¸ªæ¶ˆæ¯å¤´ï¼Œè·å–æ•°æ®æ ¼å¼ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå·±è®¾ç½®å­—å…¸çš„å‚æ•°æ¥è·å–æ•°æ®</p>
<p>![[img&#x2F;image-20210126175509471.png]]<br>è§‚å¯Ÿè¿™ä¸ªé“¾æ¥ï¼Œå‘ç°ä¸æ­¢æœ‰è¿™å‡ ä¸ªå‚æ•°</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># è®¾ç½®UA</span></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/69.0.3497.100 Safari/537.36&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># è®¾ç½®url</span></span><br><span class="line">    url = <span class="string">&quot;https://movie.douban.com/j/chart/top_list&quot;</span></span><br><span class="line">    <span class="comment"># å°†è¦å‘é€çš„æ•°æ®</span></span><br><span class="line">    param = &#123;</span><br><span class="line">        <span class="comment"># æ³¨æ„ï¼ï¼ï¼è¿™é‡Œçš„é”®å€¼å¯¹ä¸€å®šè¦è®¾ç½®æ­£ç¡®ï¼Œæ‹¼å†™ã€ç©ºæ ¼éƒ½è¦æ­£ç¡®ï¼Œä¸è¦æœ‰å¤šä½™çš„ç©ºæ ¼æˆ–è€…å°‘çš„ç©ºæ ¼ï¼ï¼ï¼ï¼</span></span><br><span class="line">        <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;5&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;interval_id&#x27;</span>: <span class="string">&#x27;100:90&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;action&#x27;</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;start&#x27;</span>: <span class="string">&#x27;0&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;limit&#x27;</span>: <span class="string">&#x27;20&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># è·å–å›åº”çš„æ•°æ®</span></span><br><span class="line">    response = requests.get(url=url, headers=headers, params=param)</span><br><span class="line">    <span class="comment"># å°†å›åº”çš„æ•°æ®è½¬åŒ–ä¸ºjsonæ ¼å¼</span></span><br><span class="line">    json_data = response.json()</span><br><span class="line">    <span class="comment"># æ•°æ®çš„æŒä¹…åŒ–å­˜å‚¨</span></span><br><span class="line">    fp = <span class="built_in">open</span>(<span class="string">&quot;movieRank&quot;</span>, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    json.dump(json_data, fp, ensure_ascii=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>

<h3 id="ç»¼åˆæ¡ˆä¾‹"><a href="#ç»¼åˆæ¡ˆä¾‹" class="headerlink" title="ç»¼åˆæ¡ˆä¾‹"></a>ç»¼åˆæ¡ˆä¾‹</h3><p>çˆ¬å–å›½å®¶è¯å“ç›‘ç£ç®¡ç†æ€»å±€ä¸­åŸºäºä¸­åäººæ°‘å…±å’Œå›½åŒ–å¦†å“ç”Ÿäº§è®¸å¯è¯ç›¸å…³æ•°æ® <a target="_blank" rel="noopener" href="http://scxk.nmpa.gov.cn:81/xk/">http://scxk.nmpa.gov.cn:81/xk/</a></p>
<p>å…·ä½“ä»£ç æŸ¥çœ‹<code>Learning\Python\Spider\01-UsageOfRequest\06-challenge.py</code></p>
<h2 id="æ•°æ®è§£æ"><a href="#æ•°æ®è§£æ" class="headerlink" title="æ•°æ®è§£æ"></a>æ•°æ®è§£æ</h2><p>èšç„¦çˆ¬è™«ï¼šçˆ¬å–é¡µé¢ä¸­æŒ‡å®šé¡µé¢çš„å†…å®¹ã€‚åœ¨èšç„¦çˆ¬è™«ä¸­è¦ç”¨åˆ°æ•°æ®è§£æã€‚</p>
<p>æ•°æ®è§£æåŸç†æ¦‚è¿°ï¼š</p>
<ul>
<li>è§£æçš„å±€éƒ¨çš„æ–‡æœ¬å†…å®¹éƒ½ä¼šåœ¨æ ‡ç­¾ä¹‹é—´æˆ–è€…æ ‡ç­¾å¯¹åº”çš„å±æ€§ä¸­è¿›è¡Œå­˜å‚¨<ol>
<li>è¿›è¡ŒæŒ‡å®šæ ‡ç­¾çš„å®šä½</li>
<li>æ ‡ç­¾æˆ–è€…æ ‡ç­¾å¯¹åº”çš„å±æ€§ä¸­å­˜å‚¨çš„æ•°æ®å€¼è¿›è¡Œæå–ï¼ˆè§£æï¼‰</li>
</ol>
</li>
</ul>
<p>æ­¥éª¤ä¸ºï¼š</p>
<ul>
<li>æŒ‡å®šurl</li>
<li>å‘èµ·è¯·æ±‚</li>
<li>è·å–å“åº”æ•°æ®</li>
<li>æ•°æ®è§£æ</li>
<li>æŒä¹…åŒ–å­˜å‚¨</li>
</ul>
<h3 id="xpathè§£æã€é‡ç‚¹ã€‘"><a href="#xpathè§£æã€é‡ç‚¹ã€‘" class="headerlink" title="xpathè§£æã€é‡ç‚¹ã€‘"></a>xpathè§£æã€é‡ç‚¹ã€‘</h3><p>æœ€å¸¸ç”¨ã€æœ€ä¾¿æ·ã€æœ€é«˜æ•ˆã€æœ€é€šç”¨ã€‚</p>
<p>åŸç†ï¼š</p>
<ol>
<li>å®ä¾‹åŒ–ä¸€ä¸ªetreeçš„å¯¹è±¡ï¼Œä¸”éœ€è¦å°†è¢«è§£æçš„é¡µé¢æºç æ•°æ®åŠ è½½åˆ°è¯¥å¯¹è±¡ä¸­ã€‚</li>
<li>è°ƒç”¨etreeå¯¹è±¡ä¸­çš„xpathæ–¹æ³•ç»“åˆç€xpathè¡¨è¾¾å¼å®ç°æ ‡ç­¾çš„å®šä½å’Œå†…å®¹çš„æ•è·ã€‚</li>
</ol>
<p>ç¯å¢ƒå®‰è£…ï¼š</p>
<ul>
<li><code>pip install lxml</code></li>
</ul>
<p>å®ä¾‹åŒ–ä¸€ä¸ªetreeå¯¹è±¡ <code>from lxml import etree</code></p>
<ol>
<li>å¯ä»¥å°†<strong>æœ¬åœ°çš„htmlæ–‡æ¡£</strong>ä¸­çš„æºç æ•°æ®åŠ è½½åˆ°etreeå¯¹è±¡ä¸­ï¼š<code>etree.parse(filePath)</code></li>
<li>å¯ä»¥å°†ä»<strong>äº’è”ç½‘</strong>ä¸Šè·å–çš„æºç æ•°æ®åŠ è½½åˆ°è¯¥å¯¹è±¡ä¸­ï¼š<code>etree.HTML(&#39;page_text&#39;)</code></li>
</ol>
<p>è°ƒç”¨xpathæ–¹æ³•è¿›è¡Œè§£æï¼š<code>xpath(&#39;xpathè¡¨è¾¾å¼&#39;)</code> ã€é‡ç‚¹ã€‘</p>
<p>xpathè¡¨è¾¾å¼(å§‹ç»ˆè¿”å›ä¸€ä¸ªåˆ—è¡¨)ï¼š</p>
<ul>
<li><code>/</code>è¡¨ç¤ºçš„æ˜¯ä»æ ¹èŠ‚ç‚¹å¼€å§‹å®šä½ã€‚è¡¨ç¤ºçš„æ˜¯ä¸€ä¸ªå±‚çº§ <code>elem = tree.xpath(&#39;/html/body/h1&#39;)</code></li>
<li><code>//</code> è¡¨ç¤ºå¯ä»¥è¡¨ç¤ºä»ä»»æ„ä½ç½®å¼€å§‹å®šä½ <code>headers = tree.xpath(&#39;//h1&#39;)  # // è¡¨ç¤ºä»ä»»æ„ä½ç½®å¼€å§‹å®šä½</code></li>
<li>å±æ€§å®šä½ï¼š <code>//tagName[@attrName=&quot;attrValue&quot;]</code> ï¼Œæ¯”å¦‚ <code>disp1 = tree.xpath(&#39;//div[@class=&quot;disp-1&quot;]&#39;)</code> è·å–åˆ°class å±æ€§ä¸º disp-1 çš„divå…ƒç´ </li>
<li>ç´¢å¼•å®šä½ï¼š <code>//tagName[@attrName=&quot;attrValue&quot;]/subTagName[index]</code> ï¼Œæ¯”å¦‚ <code>disp3 = tree.xpath(&#39;//body/div[3]&#39;)</code> è¡¨ç¤ºè·å¾—bodyæ ‡ç­¾ä¸‹çš„ç¬¬ä¸‰ä¸ªdivå…ƒç´ </li>
<li>å–å‡ºæ–‡æœ¬ï¼š<ul>
<li><code>/text()</code> å–å‡ºå…ƒç´ ä¸­<strong>ç›´ç³»</strong>çš„æ–‡æœ¬å…ƒç´ ï¼Œæ¯”å¦‚ <code>disp1_text = tree.xpath(&#39;//div[3]/text()&#39;)</code> å–å‡ºäº†å…¨å±€ç¬¬3ä¸ªdivä¸­çš„æ–‡å­—ï¼Œè¿”å›å€¼ä¸ºä¸€ä¸ªåˆ—è¡¨ï¼Œè¦æƒ³å–å¾—æ–‡æœ¬ï¼Œåº”è¯¥å»ä¸€ä¸ªä¸‹æ ‡ï¼Œä¹Ÿå°±æ˜¯ <code>disp1_text = tree.xpath(&#39;//body/text()&#39;)[0] </code></li>
<li><code>//text()</code> å–å‡ºå…ƒç´ çš„æ‰€æœ‰æ–‡æœ¬å…ƒç´ ï¼Œæ¯”å¦‚<code>disp_all_text = tree.xpath(&#39;//body//text()&#39;)</code></li>
</ul>
</li>
<li>å–å‡ºæ ‡ç­¾å±æ€§ï¼š<ul>
<li><code>/@attrName</code> ï¼Œä¹Ÿä¼šè¿”å›ä¸€ä¸ªå±æ€§å€¼åˆ—è¡¨ï¼Œæˆ‘ä»¬å¯ä»¥å»ä¸‹è¡¨æ¥å–å¾—å…ƒç´ çš„å±æ€§å€¼ã€‚æ¯”å¦‚<code>img_src = tree.xpath(&#39;//body/img/@src&#39;)[0]</code></li>
</ul>
</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>53<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span>&gt;</span>æ›¿æ¢èŠ‚ç‚¹<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>æˆ‘æ˜¯æ ‡é¢˜1<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>æˆ‘æ˜¯æ ‡é¢˜1<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>æˆ‘æ˜¯æ®µè½<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;disp-1&quot;</span>&gt;</span>this is disp1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;disp-2&quot;</span>&gt;</span>this is disp2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;disp-3&quot;</span>&gt;</span>this is disp3<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://hcdn2.luffycity.com/media/frontend/activity/head-logo_1564141048.3435316.svg&quot;</span>  <span class="attr">alt</span>=<span class="string">&quot;tupian&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼šæ‰€æœ‰xpathè¡¨è¾¾å¼ä¸­çš„ä¸‹æ ‡éƒ½ä»¥1å¼€å¤´ï¼Œæ‰€æœ‰çš„pythonåˆ—è¡¨éƒ½æ˜¯ä»¥0å¼€å¤´</p>
<h4 id="æ¡ˆä¾‹ä¸€-è§£æ58äºŒæ‰‹æˆ¿çš„ç›¸å…³æ•°æ®"><a href="#æ¡ˆä¾‹ä¸€-è§£æ58äºŒæ‰‹æˆ¿çš„ç›¸å…³æ•°æ®" class="headerlink" title="æ¡ˆä¾‹ä¸€: è§£æ58äºŒæ‰‹æˆ¿çš„ç›¸å…³æ•°æ®"></a>æ¡ˆä¾‹ä¸€: è§£æ58äºŒæ‰‹æˆ¿çš„ç›¸å…³æ•°æ®</h4><blockquote>
<p>ä»<a target="_blank" rel="noopener" href="https://zz.58.com/ershoufang/">58äºŒæ‰‹æˆ¿ç½‘ç«™</a>ä¸­è·å–äºŒæ‰‹æˆ¿çš„æ‰€æœ‰æ ‡é¢˜å’Œä»·æ ¼</p>
</blockquote>
<p>æ³¨æ„ï¼šè·å–åˆ°äº†ä¸€ä¸ªxpathèŠ‚ç‚¹ä¹‹åï¼Œå†ä»¥è·å–åˆ°çš„è¿™ä¸ªèŠ‚ç‚¹ä¸ºæ ¹èŠ‚ç‚¹å¯»æ‰¾çš„æ—¶å€™ä¸èƒ½ç”¨<code>/tag/tag...</code> è€Œæ˜¯åº”è¯¥ç”¨<code>./tag/..</code>ï¼Œ æ¯”å¦‚ æˆ‘ä»¬å·²ç»æ‰¾åˆ°äº† ä¸€ä¸ªdivèŠ‚ç‚¹ï¼Œæˆ‘ä»¬è¦å†æ¬¡å¯»æ‰¾è¿™ä¸ªèŠ‚ç‚¹ä¸‹çš„ç¬¬äºŒä¸ªdivèŠ‚ç‚¹ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä½¿ç”¨<code>theDiv.xpath(&#39;./div[2]&#39;)</code></p>
<p>æºç è§ <code>Learning\Python\Spider\02-DataAnalysis\02-xpath-SecondhandHouse.py</code></p>
<h4 id="æ¡ˆä¾‹äºŒï¼š4Kå›¾ç‰‡è§£æä¸‹è½½"><a href="#æ¡ˆä¾‹äºŒï¼š4Kå›¾ç‰‡è§£æä¸‹è½½" class="headerlink" title="æ¡ˆä¾‹äºŒï¼š4Kå›¾ç‰‡è§£æä¸‹è½½"></a>æ¡ˆä¾‹äºŒï¼š4Kå›¾ç‰‡è§£æä¸‹è½½</h4><blockquote>
<p>ä»<a target="_blank" rel="noopener" href="http://pic.netbian.com/4kfengjing/">é«˜æ¸…å£çº¸ç½‘</a>ä¸­çˆ¬å–é«˜æ¸…å£çº¸çš„ç¼©ç•¥å›¾</p>
</blockquote>
<p>ä¸­æ–‡ä¹±ç é—®é¢˜çš„é€šç”¨è§£å†³æ–¹æ¡ˆï¼š</p>
<p><code>img_name.encode(&#39;iso-8859-1&#39;).decode(&#39;gbk&#39;)</code></p>
<p>æˆ–è€…ç›´æ¥æŸ¥çœ‹é¡µé¢å…ƒæ•°æ®çš„ç¼–ç æ–¹å¼</p>
<p>åˆ›å»ºæ–‡ä»¶å¤¹å’Œå†™å…¥å›¾ç‰‡æ•°æ®</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºæ–‡ä»¶å¤¹æ¥ä¿å­˜å›¾ç‰‡</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(<span class="string">&#x27;./picLibs&#x27;</span>):</span><br><span class="line">    os.mkdir(<span class="string">&#x27;./picLibs&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†å›¾ç‰‡å†™å…¥æ–‡ä»¶</span></span><br><span class="line">img_data = requests.get(url=total_url, headers=headers).content</span><br><span class="line">img_path = <span class="string">&#x27;picLibs/&#x27;</span> + pic_title</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(img_path, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">    fp.write(img_data)</span><br><span class="line">    <span class="built_in">print</span>(pic_title + <span class="string">&#x27; success&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>æºç è§ <code>Learning\Python\Spider\02-DataAnalysis\03-xpath-PictureDownload.py</code></p>
<h4 id="æ¡ˆä¾‹ä¸‰ï¼šå…¨å›½åŸå¸‚åç§°æå–"><a href="#æ¡ˆä¾‹ä¸‰ï¼šå…¨å›½åŸå¸‚åç§°æå–" class="headerlink" title="æ¡ˆä¾‹ä¸‰ï¼šå…¨å›½åŸå¸‚åç§°æå–"></a>æ¡ˆä¾‹ä¸‰ï¼šå…¨å›½åŸå¸‚åç§°æå–</h4><blockquote>
<p>ä»<a target="_blank" rel="noopener" href="https://www.aqistudy.cn/historydata/">ä¸­å›½å¤©æ°”ç½‘</a>çˆ¬å–ä¸­å›½æ‰€æœ‰çš„åŸå¸‚çš„åç§°</p>
</blockquote>
<p>æ²¡æœ‰å¾ˆéš¾çš„çŸ¥è¯†ç‚¹ï¼Œè§£æç•¥ï¼Œæºç è§<code>Learning\Python\Spider\02-DataAnalysis\03-xpath-AllPath.py</code></p>
<h2 id="éªŒè¯ç è¯†åˆ«"><a href="#éªŒè¯ç è¯†åˆ«" class="headerlink" title="éªŒè¯ç è¯†åˆ«"></a>éªŒè¯ç è¯†åˆ«</h2><h3 id="ä½¿ç”¨å·¥å…·ç±»å’Œapiæ¥å£"><a href="#ä½¿ç”¨å·¥å…·ç±»å’Œapiæ¥å£" class="headerlink" title="ä½¿ç”¨å·¥å…·ç±»å’Œapiæ¥å£"></a>ä½¿ç”¨å·¥å…·ç±»å’Œapiæ¥å£</h3><p>æ­¥éª¤ï¼š</p>
<ul>
<li><p>å°†éªŒè¯ç äº‹å…ˆä¸‹è½½åˆ°æœ¬åœ°</p>
</li>
<li><p>å°†æœ¬åœ°å­˜å‚¨çš„éªŒè¯ç æäº¤ç»™å¹³å°çš„ç¤ºä¾‹ç¨‹åºè¿›è¡Œè¯†åˆ«æ“ä½œ</p>
</li>
</ul>
<p>è¯†åˆ«å¹³å°ï¼š<code>http://www.chaojiying.com/user/</code> </p>
<p>å…·ä½“ä»£ç è§<code>Learning\Python\Spider\03-VertifyCodeAnalysis\01-recognizeVertifyCode.py</code></p>
<h3 id="æ¨¡æ‹Ÿç™»å½•-Cookie"><a href="#æ¨¡æ‹Ÿç™»å½•-Cookie" class="headerlink" title="æ¨¡æ‹Ÿç™»å½•-Cookie"></a>æ¨¡æ‹Ÿç™»å½•-Cookie</h3><p>å¤„ç†cookieçš„ä¸¤ç§æ“ä½œï¼š</p>
<ul>
<li>æ‰‹åŠ¨å¤„ç†ï¼ŒæŠ“åŒ…ä¹‹åå°è£…åˆ°headerä¸­ã€ä¸æ¨èã€‘</li>
<li>è‡ªåŠ¨å¤„ç†</li>
</ul>
<p>http&#x2F;httpsåè®®çš„ç‰¹æ€§ï¼šæ— çŠ¶æ€</p>
<p>åŒä¸€ä¸ªæ–‡ä»¶å†…ï¼Œç¬¬ä¸€æ¬¡è¯·æ±‚ç™»å½•æˆåŠŸä¹‹åï¼Œç¬¬äºŒæ¬¡è¯·æ±‚ç™»é™†åçš„é¡µé¢æ•°æ®å¤±è´¥çš„åŸå› ï¼šæœåŠ¡å™¨ä¸çŸ¥é“è¿™æ¬¡è¯·æ±‚æ˜¯åŸºäºç™»å½•çŠ¶æ€ä¸‹çš„è¯·æ±‚ã€‚</p>
<p>cookieï¼šç”¨æ¥è®©æœåŠ¡å™¨è®°å½•å®¢æˆ·ç«¯çš„ç›¸å…³çŠ¶æ€ï¼Œcookie çš„å€¼æ¥è‡ªæ¨¡æ‹Ÿç™»å½•post è¯·æ±‚åç”±æœåŠ¡å™¨åˆ›å»º</p>
<p>sessionï¼šä½œç”¨: å‘é€è¯·æ±‚ã€å­˜å‚¨cookie</p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªsessionå¯¹è±¡ï¼Œç”¨sessionå¯¹è±¡è¿›è¡Œæ¨¡æ‹Ÿç™»å½•postè¯·æ±‚çš„å‘é€ï¼ˆcookieå°±ä¼šè¢«å­˜å‚¨åœ¨sessionä¸­ï¼‰</p>
<p>sessionå¯¹è±¡å¯¹ä¸ªäººä¸»é¡µå¯¹åº”çš„getè¯·æ±‚è¿›è¡Œå‘é€ï¼ˆæºå¸¦äº†cookieï¼‰</p>
<hr>
<p>å…·ä½“åˆ†ææ–¹æ³•ï¼š</p>
<p>æ‰“å¼€å¤è¯—æ–‡ç½‘çš„ç™»å½•é¡µé¢ <code>https://so.gushiwen.cn/user/login.aspx</code>,å¼€å¯æ•è·æ•°æ®åŒ…ï¼Œè¾“å…¥å¯†ç ç™»å½•ã€‚</p>
<p>å¯ä»¥çœ‹åˆ°htmlç±»å‹çš„postè¯·æ±‚çš„æ•°æ®åŒ…åä¸ºloginï¼Œå¯ä»¥çŒœæƒ³å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„æ•°æ®åŒ…</p>
<p>![[img&#x2F;image-20210128143417376.png]]<br>æŸ¥çœ‹æ•°æ®åŒ…çš„æ¶ˆæ¯å¤´ã€è¯·æ±‚æ•°æ®ï¼š</p>
<p>æ¶ˆæ¯å¤´</p>
<p>![[img&#x2F;image-20210128143552885.png]]<br>æ•°æ®</p>
<p>![[img&#x2F;image-20210128143535267.png]]<br>å› æ­¤ï¼Œç™»å½•è¡Œä¸ºå°±æ˜¯å‘æ¶ˆæ¯å¤´æ‰€åœ¨çš„åœ°å€å‘é€è¡¨å•æ•°æ®ä¸­çš„æ•°æ®åŒ…<code>page_data = session.post(url=login_url, headers=headers, data=data).text</code></p>
<p>ç„¶åè·å¾—è¿”å›çš„æ•°æ®ï¼Œå°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„é¡µé¢ã€‚</p>
<p>è¿™é‡Œè¦æ³¨æ„ä¸€ä¸‹ï¼Œåº”è¯¥ç”¨åŒä¸€ä¸ªsessionè®¿é—®ï¼Œä»¥è¿›è¡Œcookieçš„ç•™å­˜ã€‚</p>
<p>å…·ä½“ä»£ç è§ï¼š<code>Learning\Python\Spider\03-VertifyCodeAnalysis\02-LoginGithub.py</code></p>
<h3 id="æ¨¡æ‹Ÿç™»å½•-ä»£ç†IP"><a href="#æ¨¡æ‹Ÿç™»å½•-ä»£ç†IP" class="headerlink" title="æ¨¡æ‹Ÿç™»å½•-ä»£ç†IP"></a>æ¨¡æ‹Ÿç™»å½•-ä»£ç†IP</h3><blockquote>
<p>è¿™ä¸ªè¦é’±çš„ï¼Œè€Œä¸”æ¯”è¾ƒè´µï¼Œå…ˆä¸å­¦äº†å§ã€‚</p>
</blockquote>
<p>åœºæ™¯ï¼šå¤šæ¬¡è¯·æ±‚åŒä¸€ä¸ªç½‘ç«™ï¼Œç½‘ç«™çš„åçˆ¬æœºåˆ¶ç»„ç»‡æˆ‘ä»¬å†æ¬¡è¯·æ±‚è¿™ä¸ªç½‘ç«™ï¼Œç»™æˆ‘ä»¬è¿”å›é”™è¯¯ç»“æœ403ï¼ˆæœåŠ¡å™¨æ‹’ç»è®¿é—®ï¼‰</p>
<p>ä»£ç†å°±æ˜¯ç”¨æ¥ç ´è§£å°IPè¿™ç§åçˆ¬æœºåˆ¶çš„ã€‚</p>
<p>ä»£ç†ï¼šä»£ç†æœåŠ¡å™¨ï¼Œå®ƒçš„åŠŸèƒ½å°±æ˜¯ä»£ç†ç½‘ç»œç”¨æˆ·å»å–å¾—ç½‘ç»œä¿¡æ¯ã€‚</p>
<p>ä½œç”¨ï¼š</p>
<ul>
<li>çªç ´è‡ªèº«IPè®¿é—®çš„é™åˆ¶ï¼Œè®¿é—®ä¸€äº›å¹³æ—¶ä¸èƒ½è®¿é—®çš„ç«™ç‚¹ã€‚</li>
<li>éšè—çœŸå®IPï¼Œå…å—æ”»å‡»ï¼Œé˜²æ­¢è‡ªèº«IPè¢«å°é”</li>
</ul>
<p>ä»£ç†IPçš„ç±»å‹ï¼š</p>
<ul>
<li>httpï¼šåº”ç”¨åˆ°httpåè®®å¯¹åº”çš„urlä¸­</li>
<li>httpsï¼šåº”ç”¨åˆ°httpsåè®®å¯¹åº”çš„urlä¸­</li>
</ul>
<p>ä»£ç†IPçš„åŒ¿ååº¦ï¼š</p>
<ul>
<li>é€æ˜ï¼šæœåŠ¡å™¨çŸ¥é“è¿™æ¬¡è¯·æ±‚ä½¿ç”¨äº†ä»£ç†ï¼Œä¹ŸçŸ¥é“è¯·æ±‚å¯¹åº”çš„çœŸå®ip</li>
<li>åŒ¿åï¼šçŸ¥é“ä½¿ç”¨äº†ä»£ç†ï¼Œä¸çŸ¥é“çœŸå®ip</li>
<li>é«˜åŒ¿ï¼šä¸çŸ¥é“ä½¿ç”¨äº†ä»£ç†ï¼Œæ›´ä¸çŸ¥é“çœŸå®ip</li>
</ul>
<h2 id="é«˜æ€§èƒ½å¼‚æ­¥çˆ¬è™«"><a href="#é«˜æ€§èƒ½å¼‚æ­¥çˆ¬è™«" class="headerlink" title="é«˜æ€§èƒ½å¼‚æ­¥çˆ¬è™«"></a>é«˜æ€§èƒ½å¼‚æ­¥çˆ¬è™«</h2><p>ç›®çš„ï¼šåœ¨çˆ¬è™«ä¸­ä½¿ç”¨å¼‚æ­¥å®ç°é«˜æ€§èƒ½çš„æ•°æ®çˆ¬å–æ“ä½œ</p>
<p>æ–¹å¼ï¼š</p>
<ul>
<li>å¤šçº¿ç¨‹ï¼Œå¤šè¿›ç¨‹ï¼ˆä¸å»ºè®®ä½¿ç”¨ï¼‰ï¼š<ul>
<li>å¥½å¤„ï¼šå¯ä»¥ä¸ºç›¸å…³é˜»å¡æ“ä½œå¼€å¯çº¿ç¨‹æˆ–è€…è¿›ç¨‹</li>
<li>åå¤„ï¼šæ— æ³•æ— é™åˆ¶çš„å¼€å¯å¤šçº¿ç¨‹æˆ–è€…å¤šè¿›ç¨‹</li>
</ul>
</li>
<li>çº¿ç¨‹æ± ã€è¿›ç¨‹æ± ï¼ˆå°‘ç”¨ï¼‰ï¼š<ul>
<li>å¥½å¤„ï¼šæˆ‘ä»¬å¯ä»¥é™ä½ç³»ç»Ÿå¯¹è¿›ç¨‹æˆ–è€…çº¿ç¨‹åˆ›å»ºå’Œé”€æ¯çš„ä¸€ä¸ªé¢‘ç‡ï¼Œä»è€Œå¾ˆå¥½çš„é™ä½ç³»ç»Ÿçš„å¼€é”€</li>
<li>å¼Šç«¯ï¼šæ± ä¸­çº¿ç¨‹æˆ–è¿›ç¨‹çš„æ•°é‡æœ‰ä¸Šé™</li>
</ul>
</li>
<li>å•çº¿ç¨‹å¼‚æ­¥åç¨‹ï¼ˆ<strong>æ¨è</strong>ï¼‰</li>
</ul>
<p>Poolçº¿ç¨‹æ± å¯¹è±¡ä¸€å®šè¦æ”¾åœ¨mainå‡½æ•°ä¸‹é¢ï¼Œä¸æ”¾åœ¨è¿™é‡Œä¼šæŠ¥é”™ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing.dummy <span class="keyword">import</span> Pool</span><br><span class="line"></span><br><span class="line"><span class="meta">... </span>...</span><br><span class="line"><span class="comment"># å®ä¾‹åŒ–ä¸€ä¸ªçº¿ç¨‹æ± å¯¹è±¡</span></span><br><span class="line">pool = Pool(<span class="number">4</span>)  <span class="comment"># è¡¨ç¤ºçº¿ç¨‹æ± ä¸­æœ‰4ä¸ªçº¿ç¨‹å¯¹è±¡</span></span><br><span class="line"><span class="comment"># ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºé˜»å¡å‡½æ•°ï¼Œç¬¬äºŒä¸ªä¸ºå¯è¿­ä»£å¯¹è±¡</span></span><br><span class="line"><span class="comment"># å‡½æ•°æ‰§è¡Œçš„æ—¶å€™ä¼šå¼€è¾Ÿçº¿ç¨‹å¹¶æŠŠå¯è¿­ä»£å¯¹è±¡ä¸­çš„å€¼ä¾æ¬¡ä¼ å…¥åˆ°å‡½æ•°ä¸­è¿›è¡Œæ‰§è¡Œ</span></span><br><span class="line">pool.<span class="built_in">map</span>(get_page, name_list)</span><br></pre></td></tr></table></figure>

<p>å•çº¿ç¨‹å¼‚æ­¥åç¨‹ï¼š</p>
<p>event_loopï¼šäº‹ä»¶å¾ªç¯ï¼Œç›¸å½“äºä¸€ä¸ªæ— é™å¾ªç¯ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä¸€äº›å‡½æ•°æ³¨å†Œåˆ°è¿™ä¸ªäº‹ä»¶å¾ªç¯ä¸Šï¼Œå½“æ»¡è¶³æŸäº›æ¡ä»¶çš„æ—¶å€™ï¼Œå‡½æ•°å°±ä¼šè¢«å¾ªç¯æ‰§è¡Œã€‚</p>
<p>coroutineï¼šåç¨‹å¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥å°†åç¨‹å¯¹è±¡æ³¨å†Œåˆ°äº‹ä»¶å¾ªç¯ä¸­ï¼Œå®ƒä¼šè¢«äº‹ä»¶å¾ªç¯è°ƒç”¨ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨async å…³é”®å­—æ¥å®šä¹‰ä¸€ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•åœ¨è°ƒç”¨æ—¶ä¸ä¼šç«‹å³è¢«æ‰§è¡Œï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªåç¨‹å¯¹è±¡ã€‚</p>
<p>taskï¼šä»»åŠ¡ï¼Œå®ƒæ˜¯å¯¹åç¨‹å¯¹è±¡çš„è¿›ä¸€æ­¥å°è£…ï¼ŒåŒ…å«äº†ä»»åŠ¡çš„å„ä¸ªçŠ¶æ€ã€‚</p>
<p>futureï¼šä»£è¡¨å°†æ¥æ‰§è¡Œæˆ–è¿˜æ²¡æœ‰æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå®é™…ä¸Šå’Œtask æ²¡æœ‰æœ¬è´¨åŒºåˆ«ã€‚</p>
<p>asyncï¼šå®šä¹‰ä¸€ä¸ªåç¨‹ã€‚</p>
<p>awaitï¼šç”¨æ¥æŒ‚èµ·é˜»å¡æ–¹æ³•çš„æ‰§è¡Œã€‚</p>
<p>åç¨‹ç›¸å…³æ“ä½œï¼š</p>
<h3 id="æ¡ˆä¾‹ä¸€ï¼šçˆ¬å–æ¢¨è§†é¢‘çš„è§†é¢‘æ•°æ®"><a href="#æ¡ˆä¾‹ä¸€ï¼šçˆ¬å–æ¢¨è§†é¢‘çš„è§†é¢‘æ•°æ®" class="headerlink" title="æ¡ˆä¾‹ä¸€ï¼šçˆ¬å–æ¢¨è§†é¢‘çš„è§†é¢‘æ•°æ®"></a>æ¡ˆä¾‹ä¸€ï¼šçˆ¬å–æ¢¨è§†é¢‘çš„è§†é¢‘æ•°æ®</h3><p>åœ¨è¿™ä¸ªæ¡ˆä¾‹ä¸­ï¼ŒæŠŠå†™æ–‡ä»¶åŠŸèƒ½å†™æˆä¸€ä¸ªå‡½æ•°ï¼ˆå› ä¸ºè¿™ä¸ªåŠŸèƒ½æ¯”è¾ƒè€—æ—¶ï¼‰ã€‚</p>
<p><strong>è¿™ä¸ªç½‘ç«™åŠ ä¸Šäº†åçˆ¬æœºåˆ¶ï¼Œæ— æ³•ç ´è§£ï¼Œæ•…æ²¡æœ‰åšï¼Œç›´æ¥ç²˜è´´çš„æ•™ç¨‹ä¸Šçš„ä»£ç </strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> fake_useragent <span class="keyword">import</span> UserAgent</span><br><span class="line"><span class="comment">#å®‰è£…fake-useragentåº“:pip install fake-useragent</span></span><br><span class="line"><span class="comment">#å¯¼å…¥çº¿ç¨‹æ± æ¨¡å—</span></span><br><span class="line"><span class="keyword">from</span> multiprocessing.dummy <span class="keyword">import</span> Pool</span><br><span class="line"><span class="comment">#å®ä¾‹åŒ–çº¿ç¨‹æ± å¯¹è±¡</span></span><br><span class="line">pool = Pool()</span><br><span class="line">url = <span class="string">&#x27;http://www.pearvideo.com/category_1&#x27;</span></span><br><span class="line"><span class="comment">#éšæœºäº§ç”ŸUA</span></span><br><span class="line">ua = UserAgent().random</span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>:ua</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#è·å–é¦–é¡µé¡µé¢æ•°æ®</span></span><br><span class="line">page_text = requests.get(url=url,headers=headers).text</span><br><span class="line"><span class="comment">#å¯¹è·å–çš„é¦–é¡µé¡µé¢æ•°æ®ä¸­çš„ç›¸å…³è§†é¢‘è¯¦æƒ…é“¾æ¥è¿›è¡Œè§£æ</span></span><br><span class="line">tree = etree.HTML(page_text)</span><br><span class="line">li_list = tree.xpath(<span class="string">&#x27;//div[@id=&quot;listvideoList&quot;]/ul/li&#x27;</span>)</span><br><span class="line">detail_urls = []<span class="comment">#å­˜å‚¨äºŒçº§é¡µé¢çš„url</span></span><br><span class="line"><span class="keyword">for</span> li <span class="keyword">in</span> li_list:</span><br><span class="line">    detail_url = <span class="string">&#x27;http://www.pearvideo.com/&#x27;</span>+li.xpath(<span class="string">&#x27;./div/a/@href&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">    title = li.xpath(<span class="string">&#x27;.//div[@class=&quot;vervideo-title&quot;]/text()&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">    detail_urls.append(detail_url)</span><br><span class="line">vedio_urls = []<span class="comment">#å­˜å‚¨è§†é¢‘çš„url</span></span><br><span class="line"><span class="keyword">for</span> url <span class="keyword">in</span> detail_urls:</span><br><span class="line">    page_text = requests.get(url=url,headers=headers).text</span><br><span class="line">    vedio_url = re.findall(<span class="string">&#x27;srcUrl=&quot;(.*?)&quot;&#x27;</span>,page_text,re.S)[<span class="number">0</span>]</span><br><span class="line">    vedio_urls.append(vedio_url) </span><br><span class="line"><span class="comment">#ä½¿ç”¨çº¿ç¨‹æ± è¿›è¡Œè§†é¢‘æ•°æ®ä¸‹è½½    </span></span><br><span class="line">func_request = <span class="keyword">lambda</span> link:requests.get(url=link,headers=headers).content</span><br><span class="line">video_data_list = pool.<span class="built_in">map</span>(func_request,vedio_urls)</span><br><span class="line"><span class="comment">#ä½¿ç”¨çº¿ç¨‹æ± è¿›è¡Œè§†é¢‘æ•°æ®ä¿å­˜</span></span><br><span class="line">func_saveData = <span class="keyword">lambda</span> data:save(data)</span><br><span class="line">pool.<span class="built_in">map</span>(func_saveData,video_data_list)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">save</span>(<span class="params">data</span>):</span><br><span class="line">    fileName = <span class="built_in">str</span>(random.randint(<span class="number">1</span>,<span class="number">10000</span>))+<span class="string">&#x27;.mp4&#x27;</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(fileName,<span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">        fp.write(data)</span><br><span class="line">        <span class="built_in">print</span>(fileName+<span class="string">&#x27;å·²å­˜å‚¨&#x27;</span>)</span><br><span class="line">pool.close()</span><br><span class="line">pool.join()</span><br></pre></td></tr></table></figure>

<h2 id="Selenium"><a href="#Selenium" class="headerlink" title="Selenium"></a>Selenium</h2><h3 id="å®‰è£…ä¸ç¯å¢ƒæµ‹è¯•"><a href="#å®‰è£…ä¸ç¯å¢ƒæµ‹è¯•" class="headerlink" title="å®‰è£…ä¸ç¯å¢ƒæµ‹è¯•"></a>å®‰è£…ä¸ç¯å¢ƒæµ‹è¯•</h3><blockquote>
<p>æºç ï¼šGITHUB\Learning\Python\Spider\05-Selenium\01-test.py</p>
</blockquote>
<p>å®‰è£…ç¯å¢ƒ <code>pip install selenium</code></p>
<p>ä¸‹è½½ä¸æµè§ˆå™¨å¯¹åº”çš„é©±åŠ¨ï¼Œæ³¨æ„æŸ¥çœ‹æ˜ å°„å…³ç³»</p>
<p>ä½¿ç”¨æ­¥éª¤ï¼š</p>
<ul>
<li>å®ä¾‹åŒ–æµè§ˆå™¨å¯¹è±¡</li>
<li>ç¼–å†™è‡ªåŠ¨åŒ–æ“ä½œä»£ç </li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment">#  å®ä¾‹åŒ–ä¸€ä¸ªæµè§ˆå™¨å¯¹è±¡</span></span><br><span class="line">    bro = webdriver.Firefox(executable_path=<span class="string">&#x27;./../Utils/geckodriver.exe&#x27;</span>)</span><br><span class="line">    <span class="comment">#  è®©æµè§ˆå™¨å‘èµ·ä¸€ä¸ªæŒ‡å®šçš„urlå¯¹åº”è¯·æ±‚ , pythonç¨‹åºä¼šè‡ªåŠ¨è°ƒç”¨é©±åŠ¨æ‰“å¼€æµè§ˆå™¨è¿›è¡Œä¸€ç³»åˆ—æ“ä½œ</span></span><br><span class="line">    bro.get(<span class="string">&#x27;http://scxk.nmpa.gov.cn:81/xk/&#x27;</span>)</span><br><span class="line">    <span class="comment">#  è·å–é¡µé¢æºç </span></span><br><span class="line">    page_text = bro.page_source</span><br><span class="line">    tree = etree.HTML(page_text)</span><br><span class="line">    <span class="comment">#  è·å–åˆ—è¡¨å—</span></span><br><span class="line">    list_block = tree.xpath(<span class="string">&#x27;//ul[@id=&quot;gzlist&quot;]/li&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> items <span class="keyword">in</span> list_block:</span><br><span class="line">        title = items.xpath(<span class="string">&#x27;./dl/@title&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">        <span class="built_in">print</span>(title)</span><br><span class="line">    <span class="comment">#  å…³é—­æµè§ˆå™¨</span></span><br><span class="line">    bro.quit()</span><br></pre></td></tr></table></figure>

<h3 id="ä¸€äº›æ“ä½œ"><a href="#ä¸€äº›æ“ä½œ" class="headerlink" title="ä¸€äº›æ“ä½œ"></a>ä¸€äº›æ“ä½œ</h3><blockquote>
<p>æºç ï¼šGITHUB\Learning\Python\Spider\05-Selenium\02-OtherAutoOperations.py</p>
</blockquote>
<ul>
<li>å‘èµ·è¯·æ±‚ <code>get(url)</code></li>
<li>æ ‡ç­¾å®šä½ <code>find_...ç³»åˆ—çš„æ–¹æ³•</code> </li>
<li>æ ‡ç­¾äº¤äº’ <code>send_keys(&#39;xxx&#39;)</code></li>
<li>æ‰§è¡Œjsç¨‹åº <code>execute_sctript(&#39;JsCode&#39;)</code></li>
<li>å‰è¿›å’Œåé€€ <code>back(), forward()</code></li>
<li>å…³é—­æµè§ˆå™¨ <code>quit()</code></li>
</ul>
<p>å®šä½å…ƒç´ ï¼š</p>
<p>![[img&#x2F;image-20210129212959044.png]]</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># æ³¨å†Œæµè§ˆå™¨</span></span><br><span class="line">    bro = webdriver.Firefox(executable_path=<span class="string">&#x27;./../Utils/geckodriver.exe&#x27;</span>)</span><br><span class="line">    <span class="comment"># è·å–é¡µé¢</span></span><br><span class="line">    bro.get(<span class="string">&#x27;http://scxk.nmpa.gov.cn:81/xk/&#x27;</span>)</span><br><span class="line">    <span class="comment"># æ ‡ç­¾å®šä½ - æŸ¥è¯¢ä¿¡æ¯</span></span><br><span class="line">    enter = bro.find_element_by_id(<span class="string">&quot;searchtext&quot;</span>)</span><br><span class="line">    <span class="comment"># å‘æ–‡æœ¬æ¡†ä¸­è¾“å…¥ 20170002</span></span><br><span class="line">    enter.send_keys(<span class="string">&quot;20170002&quot;</span>)</span><br><span class="line">    <span class="comment">#  æŸ¥æ‰¾æœç´¢æŒ‰é’®</span></span><br><span class="line">    btn = bro.find_element_by_id(<span class="string">&#x27;searchInfo&#x27;</span>)</span><br><span class="line">    <span class="comment">#  ç‚¹å‡»æŸ¥æ‰¾æŒ‰é’®æŒ‰é’®</span></span><br><span class="line">    btn.click()</span><br><span class="line">    <span class="comment">#  æ‰§è¡Œjsä»£ç ï¼Œå‘ä¸‹æ»šåŠ¨ä¸€å±å¹•çš„è·ç¦»</span></span><br><span class="line">    bro.execute_script(<span class="string">&#x27;window.scrollTo(0, document.body.scrollHeight)&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å†æ¬¡è·³è½¬åˆ°é¡µé¢</span></span><br><span class="line">    bro.get(<span class="string">&#x27;http://kaifa.baidu.com/home&#x27;</span>)</span><br><span class="line">    <span class="comment"># å›é€€åˆ°ä¸Šä¸€ä¸ªé¡µé¢</span></span><br><span class="line">    bro.back()</span><br><span class="line">    <span class="comment"># è¿”å›åˆ°ä¸Šä¸€ä¸ªé¡µé¢</span></span><br><span class="line">    bro.forward()</span><br><span class="line">    <span class="comment">#  å…³é—­æµè§ˆå™¨</span></span><br><span class="line">    bro.quit()</span><br></pre></td></tr></table></figure>

<h3 id="selenuimå¤„ç†iframe"><a href="#selenuimå¤„ç†iframe" class="headerlink" title="selenuimå¤„ç†iframe"></a>selenuimå¤„ç†iframe</h3><p>å®ç°æ‹–åŠ¨æ“ä½œï¼ˆåŠ¨ä½œé“¾ï¼‰</p>
<blockquote>
<p>æºç ï¼šGITHUB\Learning\Python\Spider\05-Selenium\03-ActionChain.py</p>
</blockquote>
<p>å¦‚æœå®šä½çš„æ ‡ç­¾åœ¨iframeä¸­ï¼Œåˆ™å¿…é¡»ä½¿ç”¨<code>switch_to.frame(id)</code></p>
<p>åŠ¨ä½œé“¾ï¼š</p>
<ul>
<li><code>from selenium.webdriver import ActionChains</code></li>
<li>å®ä¾‹åŒ–ä¸€ä¸ªåŠ¨ä½œé“¾å¯¹è±¡ï¼š<code>action = ActionChains(bro)</code></li>
<li><code>click_and_hold(div)</code> é•¿æŒ‰ä¸”ç‚¹å‡»æ“ä½œ</li>
<li><code>move_by_offset(x, y)</code> åç§»</li>
<li><code>perform()</code> ç«‹å³æ‰§è¡ŒåŠ¨ä½œé“¾</li>
<li><code> action.release()</code> é‡Šæ”¾åŠ¨ä½œé“¾</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    bro = webdriver.Firefox(executable_path=<span class="string">&#x27;./../Utils/geckodriver.exe&#x27;</span>)</span><br><span class="line">    bro.get(<span class="string">&#x27;https://www.runoob.com/try/try.php?filename=jqueryui-api-droppable&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#  å¦‚æœè¦ä¸æ–‡çš„æ ‡ç­¾æ˜¯iframeæ ‡ç­¾çš„è¯ï¼Œå°±å¿…é¡»é€šè¿‡ä»¥ä¸‹æ–¹å¼æ¥è½¬æ¢å®šä½ä½œç”¨åŸŸ</span></span><br><span class="line">    <span class="comment">#  å› ä¸ºiframeæ˜¯åœ¨htmlä¸­åº”ç”¨çš„å¦ä¸€ä¸ªhtmlï¼Œå®šä½çš„æ—¶å€™æ˜¯é»˜è®¤çš„å¤–å±‚çš„html</span></span><br><span class="line">    bro.switch_to.frame(<span class="string">&#x27;iframeResult&#x27;</span>)</span><br><span class="line">    div = bro.find_element_by_id(<span class="string">&#x27;draggable&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># åŠ¨ä½œé“¾</span></span><br><span class="line">    action = ActionChains(bro)</span><br><span class="line">    <span class="comment"># ç‚¹å‡»é•¿å®‰æŒ‡å®šçš„æ ‡ç­¾</span></span><br><span class="line">    action.click_and_hold(div)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ¨¡æ‹Ÿäººæ‹–åŠ¨æ»‘å—</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">        <span class="comment"># perform() ç«‹å³æ‰§è¡ŒåŠ¨ä½œé“¾</span></span><br><span class="line">        <span class="comment"># move_by_offset(x, y) åç§»</span></span><br><span class="line">        action.move_by_offset(<span class="number">17</span>, <span class="number">0</span>).perform()</span><br><span class="line">        <span class="comment"># ä¼‘çœ 0.3ç§’</span></span><br><span class="line">        sleep(<span class="number">0.1</span>)</span><br><span class="line">    <span class="comment"># é‡Šæ”¾åŠ¨ä½œé“¾</span></span><br><span class="line">    action.release()</span><br><span class="line">    sleep(<span class="number">5</span>)</span><br><span class="line">    bro.quit()</span><br></pre></td></tr></table></figure>


<h3 id="æ— å¤´æµè§ˆå™¨-è§„é¿æ£€æµ‹"><a href="#æ— å¤´æµè§ˆå™¨-è§„é¿æ£€æµ‹" class="headerlink" title="æ— å¤´æµè§ˆå™¨ + è§„é¿æ£€æµ‹"></a>æ— å¤´æµè§ˆå™¨ + è§„é¿æ£€æµ‹</h3><blockquote>
<p>Learning\Python\Spider\05-Selenium\04-HeadlessBrowser.py</p>
</blockquote>
<p>æ— å¯è§†åŒ–ç•Œé¢çš„æµè§ˆå™¨</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.firefox.options <span class="keyword">import</span> Options</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    firefox_options = Options()</span><br><span class="line">    firefox_options.add_argument(<span class="string">&#x27;--headless&#x27;</span>)</span><br><span class="line">    firefox_options.add_argument(<span class="string">&#x27;--disable-gpu&#x27;</span>)</span><br><span class="line">    bro = webdriver.Firefox(executable_path=<span class="string">&#x27;./../Utils/geckodriver.exe&#x27;</span>, firefox_options=firefox_options)</span><br><span class="line">    <span class="comment"># ------------æ— å¤´æµè§ˆå™¨-----------</span></span><br><span class="line">    bro.get(<span class="string">&quot;http://kaifa.baidu.com/home&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(bro.page_source)</span><br><span class="line">    bro.quit()</span><br></pre></td></tr></table></figure>

<p>è§„é¿æ£€æµ‹ï¼Œç”¨çš„æ—¶å€™ç›´æ¥å¤åˆ¶å°±è¡Œ</p>
<p>ç«ç‹çš„æœ‰é—®é¢˜ï¼Œè¿™ä¸ªæ˜¯chromeçš„ ï¼Œç«ç‹çš„æ²¡æœ‰add_experimental_optionå¯¹è±¡å®ä¾‹ï¼Œæ‰€ä»¥å…ˆç”¨chromeçš„å§</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="comment"># å®ç°æ— å¯è§†åŒ–ç•Œé¢</span></span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.chrome.options <span class="keyword">import</span> Options</span><br><span class="line"><span class="comment"># å®ç°è§„é¿å»ºæµ‹</span></span><br><span class="line"><span class="keyword">from</span> selenium.webdriver <span class="keyword">import</span> ChromeOptions</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># å®ç°æ— å¯è§†åŒ–æ“ä½œ</span></span><br><span class="line">    chrome_options = Options()</span><br><span class="line">    chrome_options.add_argument(<span class="string">&#x27;--headless&#x27;</span>)</span><br><span class="line">    chrome_options.add_argument(<span class="string">&#x27;--disable-gpu&#x27;</span>)</span><br><span class="line">    <span class="comment"># å®ç°è§„é¿æ£€æµ‹</span></span><br><span class="line">    options = ChromeOptions()</span><br><span class="line">    options.add_experimental_option(<span class="string">&#x27;excludeSwitches&#x27;</span>, [<span class="string">&#x27;enable-automation&#x27;</span>])</span><br><span class="line"></span><br><span class="line">    bro = webdriver.Firefox(executable_path=<span class="string">&#x27;./driver&#x27;</span>,</span><br><span class="line">                            firefox_options=chrome_options,</span><br><span class="line">                            options=options)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ------------æ— å¤´æµè§ˆå™¨ + è§„é¿æ£€æµ‹-----------</span></span><br><span class="line">    bro.get(<span class="string">&quot;http://kaifa.baidu.com/home&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(bro.page_source)</span><br><span class="line">    bro.quit()</span><br></pre></td></tr></table></figure>

<h2 id="Scrapyæ¡†æ¶"><a href="#Scrapyæ¡†æ¶" class="headerlink" title="Scrapyæ¡†æ¶"></a>Scrapyæ¡†æ¶</h2><h3 id="ç¯å¢ƒå®‰è£…"><a href="#ç¯å¢ƒå®‰è£…" class="headerlink" title="ç¯å¢ƒå®‰è£…"></a>ç¯å¢ƒå®‰è£…</h3><p>æ˜¯ä»€ä¹ˆï¼Ÿ çˆ¬è™«ä¸­å°è£…å¥½çš„ä¸€ä¸ªæ˜æ˜Ÿæ¡†æ¶ï¼ŒåŠŸèƒ½: é«˜æ€§èƒ½çš„æŒä¹…åŒ–å­˜å‚¨ï¼Œé«˜æ€§èƒ½çš„æ•°æ®è§£æï¼Œåˆ†å¸ƒå¼å¤„ç†</p>
<p>å®‰è£…ï¼šmax &#x2F; linux <code>pip install scrapy</code></p>
<p>windowså®‰è£…</p>
<ul>
<li><code>pip install wheel</code></li>
<li>ä¸‹è½½twisted ä¸‹è½½åœ°å€ä¸º<a target="_blank" rel="noopener" href="http://www.lfd.uci.edu/~gohlke/pythonlibs/#twisted">http://www.lfd.uci.edu/~gohlke/pythonlibs/#twisted</a>  ä¸‹è½½æ–‡ä»¶<code>ad3â€‘2.2.1â€‘cp37â€‘cp37mâ€‘win_amd64.whl</code> cp37è¡¨ç¤ºpython3.7ï¼Œwin_amd64è¡¨ç¤ºwin64</li>
<li>åœ¨æœ‰è¿™ä¸ªè½®å­çš„èµ„æºç®¡ç†å™¨é¡µé¢æ‰“å¼€cmdæ‰§è¡Œ<code>pip install Twistedâ€‘17.1.0â€‘cp36â€‘cp36mâ€‘win_amd64.whl</code></li>
<li><code>pip install pywin32</code></li>
<li><code>pip install scrapy</code></li>
</ul>
<p>æµ‹è¯•ï¼šåœ¨ç»ˆç«¯é‡Œå½•å…¥scrapyæŒ‡ä»¤ï¼Œæ²¡æœ‰æŠ¥é”™å³è¡¨ç¤ºå®‰è£…æˆåŠŸï¼</p>
<p>scrapyä½¿ç”¨æµç¨‹ï¼š</p>
<ul>
<li>åˆ›å»ºå·¥ç¨‹ï¼š<code>scrapy startproject ProName</code></li>
<li>è¿›å…¥å·¥ç¨‹ç›®å½•ï¼š<code>cd ProName</code></li>
<li>åˆ›å»ºçˆ¬è™«æ–‡ä»¶ï¼š<code>scrapy genspider spiderName www.xxx.com</code></li>
<li>ç¼–å†™ç›¸å…³æ“ä½œä»£ç </li>
<li>æ‰§è¡Œå·¥ç¨‹ï¼š<code>scrapy crawl spiderName</code></li>
</ul>
<p>scrapyåœ¨æ‰§è¡Œçš„æ—¶å€™ä¼šæœ‰å¾ˆå¤šæ—¥å¿—ä¿¡æ¯ï¼Œå¦‚æœä¸æƒ³çœ‹ï¼Œå¯ä»¥åœ¨é…ç½®æ–‡ä»¶<code>project/settings.py</code> ä¸­ç¬¬23è¡Œé™„è¿‘åŠ ä¸Šè¿™å¥è¯<code>LOG_LEVEL = &#39;ERROR&#39; # åªæ˜¾ç¤ºæŒ‡å®šç±»å‹çš„æ—¥å¿—ä¿¡æ¯</code></p>
<p>è¯·æ±‚å¤´çš„æ”¹å˜ï¼šsettings.pyä¸­ï¼Œ17è¡Œçš„useragentæ³¨é‡Šè§£å¼€ï¼Œç„¶ååŠ ä¸Šè‡ªå·±çš„è¯·æ±‚å¤´å³å¯</p>
<h3 id="Scrapyå®ç°æ•°æ®è§£æä¸æ•°æ®æŒä¹…åŒ–"><a href="#Scrapyå®ç°æ•°æ®è§£æä¸æ•°æ®æŒä¹…åŒ–" class="headerlink" title="Scrapyå®ç°æ•°æ®è§£æä¸æ•°æ®æŒä¹…åŒ–"></a>Scrapyå®ç°æ•°æ®è§£æä¸æ•°æ®æŒä¹…åŒ–</h3><p><code>scrapy genspider spiderName www.xxx.com</code> åˆ›å»ºçˆ¬è™«æ–‡ä»¶ä¹‹åï¼Œä¼šåœ¨spiderä¸­è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªçˆ¬è™«æ–‡ä»¶ï¼Œå…¶ä¸­çš„parseæ–¹æ³•å°±æ˜¯ç”¨æ¥å¤„ç†æ•°æ®çš„ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">QiubaiSpider</span>(scrapy.Spider):</span><br><span class="line">    name = <span class="string">&#x27;qiubai&#x27;</span></span><br><span class="line">    start_urls = [<span class="string">&#x27;https://www.qiushibaike.com/text/&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse</span>(<span class="params">self, response</span>):</span><br><span class="line">        div_list = response.xpath(<span class="string">&#x27;//div[@class=&quot;col1 old-style-col1&quot;]/div&#x27;</span>)</span><br><span class="line">        all_data = []</span><br><span class="line">        <span class="keyword">for</span> div <span class="keyword">in</span> div_list:</span><br><span class="line">            <span class="comment"># xpathè¿”å›çš„æ˜¯åˆ—è¡¨ï¼Œè¿”å›çš„æ˜¯Selectorç±»å‹å¯¹è±¡</span></span><br><span class="line">            <span class="comment"># ä½¿ç”¨ extract() æå–dataä¸­çš„å­—ç¬¦ä¸²</span></span><br><span class="line">            title = div.xpath(<span class="string">&#x27;./div[1]/a[2]/h2/text()&#x27;</span>)[<span class="number">0</span>].extract()</span><br><span class="line">            <span class="comment"># åˆ—è¡¨è°ƒç”¨äº†extractè¡¨ç¤ºå°†æ¯ä¸€ä¸ªselectå¯¹è±¡ä¸­çš„dataå­—ç¬¦ä¸²æå–å‡ºæ¥ï¼Œè¿”å›åˆ—è¡¨</span></span><br><span class="line">            content = div.xpath(<span class="string">&#x27;./a[1]/div/span/text()&#x27;</span>).extract()</span><br><span class="line">            content = <span class="string">&#x27;&#x27;</span>.join(content)</span><br><span class="line">            all_data.append(&#123;</span><br><span class="line">                <span class="string">&quot;author&quot;</span>: title,</span><br><span class="line">                <span class="string">&quot;content&quot;</span>: content</span><br><span class="line">            &#125;)</span><br><span class="line">        <span class="keyword">return</span> all_data</span><br></pre></td></tr></table></figure>

<hr>
<p>æŒä¹…åŒ–æ–¹æ³•ï¼š</p>
<ul>
<li>åŸºäºç»ˆç«¯æŒ‡ä»¤çš„æŒä¹…åŒ–<ul>
<li>åªèƒ½æŒä¹…åŒ–åˆ°æ–‡ä»¶</li>
<li>åªèƒ½å°†è¿”å›å€¼æŒä¹…åŒ–ï¼Œæˆ‘ä»¬è¦å¯¹æ¸…æ´—åçš„æ•°æ®è¿›è¡Œå°è£…</li>
<li>é«˜æ•ˆä¾¿æ·ï¼Œä½†å±€é™æ€§å¼ºï¼ˆæ–‡ä»¶ç±»å‹æœ‰é™ï¼‰</li>
</ul>
</li>
<li>åŸºäºç®¡é“çš„æŒä¹…åŒ–</li>
</ul>
<p>åŸºäºç»ˆç«¯æŒ‡ä»¤çš„æŒä¹…åŒ–ï¼š</p>
<p>çˆ¬è™«æ–‡ä»¶ä¸­çš„parseæ–¹æ³•å¿…é¡»æœ‰è¿”å›å€¼</p>
<p><code>scrapy crawl çˆ¬è™«åç§° -o è·¯å¾„</code></p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">scrapy crawl çˆ¬è™«åç§° -o xxx.json</span><br><span class="line">scrapy crawl çˆ¬è™«åç§° -o xxx.xml</span><br><span class="line">scrapy crawl çˆ¬è™«åç§° -o xxx.csv</span><br></pre></td></tr></table></figure>

<p>ä¸¾ä¾‹<code>D:\GITHUB\Learning\Python\Spider\06-Scrapy\QiuBai&gt;scrapy crawl qiubai -o ./qiubai.csv</code></p>
<hr>
<p>åŸºäºç®¡é“çš„æŒä¹…åŒ–ï¼Œæµç¨‹ï¼š</p>
<ol>
<li>æ•°æ®è§£æ</li>
<li>åœ¨itemç±»ä¸­å®šä¹‰ç›¸å…³çš„å±æ€§,  å®ç°<code>items.py</code>, å±æ€§æ ¼å¼ï¼š<code>name = scrapy.Field()</code></li>
<li>å°†è§£æçš„æ•°æ®å°è£…å­˜å‚¨åˆ°itemç±»å‹çš„å¯¹è±¡ä¸­</li>
<li>å°†itemç±»å‹çš„å¯¹è±¡æäº¤ç»™ç®¡é“è¿›è¡ŒæŒä¹…åŒ–å­˜å‚¨çš„æ“ä½œ <code>piplines.py</code></li>
<li>åœ¨ç®¡é“ç±»çš„ptocess_itemä¸­æ¥æ”¶çˆ¬è™«æ–‡ä»¶æäº¤è¿‡æ¥çš„itemå¯¹è±¡ï¼Œç„¶åç¼–å†™æŒä¹…åŒ–å­˜å‚¨çš„ä»£ç å°†itemå¯¹è±¡ä¸­å­˜å‚¨çš„æ•°æ®è¿›è¡ŒæŒä¹…åŒ–å­˜å‚¨</li>
<li><code>settings.py</code>é…ç½®æ–‡ä»¶ä¸­å¼€å¯ç®¡é“</li>
</ol>
<p>æºç è§ï¼š<code>GITHUB\Learning\Python\Spider\06-Scrapy\BasedOnPipline</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  spider.py</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"></span><br><span class="line"><span class="comment">#  æ³¨æ„ï¼Œè¿™é‡Œåœ¨å¯¼åŒ…çš„æ—¶å€™è¦å°†é¡¹ç›®çš„ç›®å½•markä¸ºSource Root</span></span><br><span class="line"><span class="keyword">from</span> BasedOnPipline.items <span class="keyword">import</span> BasedonpiplineItem</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">QiubaiSpider</span>(scrapy.Spider):</span><br><span class="line">    name = <span class="string">&#x27;BasedOnPipline&#x27;</span></span><br><span class="line">    start_urls = [<span class="string">&#x27;https://www.qiushibaike.com/text/&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse</span>(<span class="params">self, response</span>):</span><br><span class="line">        div_list = response.xpath(<span class="string">&#x27;//div[@class=&quot;col1 old-style-col1&quot;]/div&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> div <span class="keyword">in</span> div_list:</span><br><span class="line">            <span class="comment"># xpathè¿”å›çš„æ˜¯åˆ—è¡¨ï¼Œè¿”å›çš„æ˜¯Selectorç±»å‹å¯¹è±¡</span></span><br><span class="line">            <span class="comment"># ä½¿ç”¨ extract() æå–dataä¸­çš„å­—ç¬¦ä¸²</span></span><br><span class="line">            title = div.xpath(<span class="string">&#x27;./div[1]/a[2]/h2/text() | ./div[1]/span/h2/text()&#x27;</span>)[<span class="number">0</span>].extract()</span><br><span class="line">            <span class="comment"># åˆ—è¡¨è°ƒç”¨äº†extractè¡¨ç¤ºå°†æ¯ä¸€ä¸ªselectå¯¹è±¡ä¸­çš„dataå­—ç¬¦ä¸²æå–å‡ºæ¥ï¼Œè¿”å›åˆ—è¡¨</span></span><br><span class="line">            content = div.xpath(<span class="string">&#x27;./a[1]/div/span/text()&#x27;</span>).extract()</span><br><span class="line">            content = <span class="string">&#x27;&#x27;</span>.join(content)</span><br><span class="line">            item = BasedonpiplineItem()</span><br><span class="line">            item[<span class="string">&#x27;author&#x27;</span>] = title</span><br><span class="line">            item[<span class="string">&#x27;content&#x27;</span>] = content</span><br><span class="line">            <span class="keyword">yield</span> item  <span class="comment"># æäº¤item</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># items.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BasedonpiplineItem</span>(scrapy.Item):</span><br><span class="line">    author = scrapy.Field()</span><br><span class="line">    content = scrapy.Field()</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># puplines.py</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BasedonpiplinePipeline</span>:</span><br><span class="line">    fp = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># é‡å†™çˆ¶ç±»çš„ä¸€ä¸ªæ–¹æ³•æ²¡è¿™ä»½æ–¹æ³•åªåœ¨å¼€å§‹çˆ¬è™«çš„æ—¶å€™è°ƒç”¨ä¸€æ¬¡</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">open_spider</span>(<span class="params">self, spider</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;start.....&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.fp = <span class="built_in">open</span>(<span class="string">&#x27;./qiubai.txt&#x27;</span>, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ç”¨æ¥å¤„ç†itemç±»å‹çš„å¯¹è±¡çš„</span></span><br><span class="line">    <span class="comment"># è¯¥æ–¹æ³•å¯ä»¥æ¥å—çˆ¬è™«æ–‡ä»¶æäº¤çš„itemå¯¹è±¡</span></span><br><span class="line">    <span class="comment"># æ¯æ¥å—ä¸€æ¬¡å‚æ•°éƒ½ä¼šè°ƒç”¨ä¸€æ¬¡</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_item</span>(<span class="params">self, item, spider</span>):</span><br><span class="line">        author = item[<span class="string">&#x27;author&#x27;</span>]</span><br><span class="line">        content = item[<span class="string">&#x27;content&#x27;</span>]</span><br><span class="line">        <span class="variable language_">self</span>.fp.write(author + <span class="string">&#x27; : &#x27;</span> + content + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> item</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">close_spider</span>(<span class="params">self, spider</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;the end...&#x27;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.fp.close()</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼š</p>
<ul>
<li>settings.py é‡Œé¢è¦è®¾ç½®userAgent å’Œ ITEM_PIPELINES</li>
</ul>
<p>é¢è¯•é¢˜ï¼š</p>
<p>å¦‚æœæœ€ç»ˆéœ€è¦å°†çˆ¬å–åˆ°çš„æ•°æ®å€¼ä¸€ä»½å­˜å‚¨åˆ°ç£ç›˜æ–‡ä»¶ï¼Œä¸€ä»½å­˜å‚¨åˆ°æ•°æ®åº“ä¸­ï¼Œåˆ™åº”è¯¥å¦‚ä½•æ“ä½œscrapyï¼Ÿ</p>
<p>ç­”ï¼šç®¡é“æ–‡ä»¶ä¸­çš„ä»£ç ä¸ºï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#è¯¥ç±»ä¸ºç®¡é“ç±»ï¼Œè¯¥ç±»ä¸­çš„process_itemæ–¹æ³•æ˜¯ç”¨æ¥å®ç°æŒä¹…åŒ–å­˜å‚¨æ“ä½œçš„ã€‚</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DoublekillPipeline</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">process_item</span>(<span class="params">self, item, spider</span>):</span><br><span class="line">	<span class="comment">#æŒä¹…åŒ–æ“ä½œä»£ç  ï¼ˆæ–¹å¼1ï¼šå†™å…¥ç£ç›˜æ–‡ä»¶ï¼‰</span></span><br><span class="line">	<span class="keyword">return</span> item</span><br><span class="line">    <span class="comment">#å¦‚æœæƒ³å®ç°å¦ä¸€ç§å½¢å¼çš„æŒä¹…åŒ–æ“ä½œï¼Œåˆ™å¯ä»¥å†å®šåˆ¶ä¸€ä¸ªç®¡é“ç±»ï¼š</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DoublekillPipeline_db</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_item</span>(<span class="params">self, item, spider</span>):</span><br><span class="line">    <span class="comment">#æŒä¹…åŒ–æ“ä½œä»£ç  ï¼ˆæ–¹å¼2ï¼šå†™å…¥æ•°æ®åº“ï¼‰</span></span><br><span class="line">    <span class="keyword">return</span> item</span><br></pre></td></tr></table></figure>

<p>settings.py ä¸­å¼€å¯ç®¡é“æ“ä½œçš„ä»£ç :</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ä¸‹åˆ—ç»“æ„ä¸ºå­—å…¸ï¼Œå­—å…¸ä¸­çš„é”®å€¼è¡¨ç¤ºçš„æ˜¯å³å°†è¢«å¯ç”¨æ‰§è¡Œçš„ç®¡é“æ–‡ä»¶å’Œå…¶æ‰§è¡Œçš„ä¼˜å…ˆçº§ã€‚</span></span><br><span class="line">ITEM_PIPELINES = &#123;</span><br><span class="line"> <span class="string">&#x27;doublekill.pipelines.DoublekillPipeline&#x27;</span>: <span class="number">300</span>,</span><br><span class="line">  <span class="string">&#x27;doublekill.pipelines.DoublekillPipeline_db&#x27;</span>: <span class="number">200</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¸Šè¿°ä»£ç ä¸­ï¼Œå­—å…¸ä¸­çš„ä¸¤ç»„é”®å€¼åˆ†åˆ«è¡¨ç¤ºä¼šæ‰§è¡Œç®¡é“æ–‡ä»¶ä¸­å¯¹åº”çš„ä¸¤ä¸ªç®¡é“ç±»ä¸­çš„process_itemæ–¹æ³•ï¼Œå®ç°ä¸¤ç§ä¸åŒå½¢å¼çš„æŒä¹…åŒ–æ“ä½œã€‚</span></span><br></pre></td></tr></table></figure>

<h4 id="ç»ƒä¹ -åŸºäºSpiderçš„å…¨ç«™æ•°æ®çˆ¬å–"><a href="#ç»ƒä¹ -åŸºäºSpiderçš„å…¨ç«™æ•°æ®çˆ¬å–" class="headerlink" title="ç»ƒä¹  - åŸºäºSpiderçš„å…¨ç«™æ•°æ®çˆ¬å–"></a>ç»ƒä¹  - åŸºäºSpiderçš„å…¨ç«™æ•°æ®çˆ¬å–</h4><p>é¢˜ç›®ï¼šçˆ¬å–å°è¯´ <a target="_blank" rel="noopener" href="http://www.paoshuzw.com/27/27256/">ä¸´æ¸Šè¡Œ</a>  çš„æ‰€æœ‰ç« èŠ‚å†…å®¹</p>
<p>æºç è§ &#96;GITHUB\Learning\Python\Spider\06-Scrapy\Alldata</p>
<h3 id="Scrapyäº”å¤§æ ¸å¿ƒç»„ä»¶"><a href="#Scrapyäº”å¤§æ ¸å¿ƒç»„ä»¶" class="headerlink" title="Scrapyäº”å¤§æ ¸å¿ƒç»„ä»¶"></a>Scrapyäº”å¤§æ ¸å¿ƒç»„ä»¶</h3><p>![[img&#x2F;image-20210208170904800.png]]</p>
<ul>
<li>å¼•æ“(Scrapy)<ul>
<li>ç”¨æ¥å¤„ç†æ•´ä¸ªç³»ç»Ÿçš„æ•°æ®æµå¤„ç†, è§¦å‘äº‹åŠ¡(æ¡†æ¶æ ¸å¿ƒ)</li>
</ul>
</li>
<li>è°ƒåº¦å™¨(Scheduler)<ul>
<li>ç”¨æ¥æ¥å—å¼•æ“å‘è¿‡æ¥çš„è¯·æ±‚, å‹å…¥é˜Ÿåˆ—ä¸­, å¹¶åœ¨å¼•æ“å†æ¬¡è¯·æ±‚çš„æ—¶å€™è¿”å›. å¯ä»¥æƒ³åƒæˆä¸€ä¸ªURLï¼ˆæŠ“å–ç½‘é¡µçš„ç½‘å€æˆ–è€…è¯´æ˜¯é“¾æ¥ï¼‰çš„ä¼˜å…ˆé˜Ÿåˆ—, ç”±å®ƒæ¥å†³å®šä¸‹ä¸€ä¸ªè¦æŠ“å–çš„ç½‘å€æ˜¯ä»€ä¹ˆ, åŒæ—¶å»é™¤é‡å¤çš„ç½‘å€</li>
</ul>
</li>
<li>ä¸‹è½½å™¨(Downloader)<ul>
<li>ç”¨äºä¸‹è½½ç½‘é¡µå†…å®¹, å¹¶å°†ç½‘é¡µå†…å®¹è¿”å›ç»™èœ˜è››(Scrapyä¸‹è½½å™¨æ˜¯å»ºç«‹åœ¨twistedè¿™ä¸ªé«˜æ•ˆçš„å¼‚æ­¥æ¨¡å‹ä¸Šçš„)</li>
</ul>
</li>
<li>çˆ¬è™«(Spiders)<ul>
<li>çˆ¬è™«æ˜¯ä¸»è¦å¹²æ´»çš„, ç”¨äºä»ç‰¹å®šçš„ç½‘é¡µä¸­æå–è‡ªå·±éœ€è¦çš„ä¿¡æ¯, å³æ‰€è°“çš„å®ä½“(Item)ã€‚ç”¨æˆ·ä¹Ÿå¯ä»¥ä»ä¸­æå–å‡ºé“¾æ¥,è®©Scrapyç»§ç»­æŠ“å–ä¸‹ä¸€ä¸ªé¡µé¢</li>
</ul>
</li>
<li>é¡¹ç›®ç®¡é“(Pipeline)<ul>
<li>è´Ÿè´£å¤„ç†çˆ¬è™«ä»ç½‘é¡µä¸­æŠ½å–çš„å®ä½“ï¼Œä¸»è¦çš„åŠŸèƒ½æ˜¯æŒä¹…åŒ–å®ä½“ã€éªŒè¯å®ä½“çš„æœ‰æ•ˆæ€§ã€æ¸…é™¤ä¸éœ€è¦çš„ä¿¡æ¯ã€‚å½“é¡µé¢è¢«çˆ¬è™«è§£æåï¼Œå°†è¢«å‘é€åˆ°é¡¹ç›®ç®¡é“ï¼Œå¹¶ç»è¿‡å‡ ä¸ªç‰¹å®šçš„æ¬¡åºå¤„ç†æ•°æ®ã€‚</li>
</ul>
</li>
</ul>
<h3 id="è¯·æ±‚ä¼ å‚"><a href="#è¯·æ±‚ä¼ å‚" class="headerlink" title="è¯·æ±‚ä¼ å‚"></a>è¯·æ±‚ä¼ å‚</h3><ul>
<li>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çˆ¬å–çš„æ•°æ®ä¸åœ¨åŒä¸€ä¸ªé¡µé¢ä¸­ï¼Œä¾‹å¦‚ï¼Œæˆ‘ä»¬çˆ¬å–ä¸€ä¸ªç”µå½±ç½‘ç«™ï¼Œç”µå½±çš„åç§°ï¼Œè¯„åˆ†åœ¨ä¸€çº§é¡µé¢ï¼Œè€Œè¦çˆ¬å–çš„å…¶ä»–ç”µå½±è¯¦æƒ…åœ¨å…¶äºŒçº§å­é¡µé¢ä¸­ã€‚è¿™æ—¶æˆ‘ä»¬å°±éœ€è¦ç”¨åˆ°è¯·æ±‚ä¼ å‚ã€‚</li>
<li>è¯·æ±‚ä¼ å‚çš„ä½¿ç”¨åœºæ™¯<ul>
<li>å½“æˆ‘ä»¬ä½¿ç”¨çˆ¬è™«çˆ¬å–çš„æ•°æ®æ²¡æœ‰å­˜åœ¨äºåŒä¸€å¼ é¡µé¢çš„æ—¶å€™ï¼Œåˆ™å¿…é¡»ä½¿ç”¨è¯·æ±‚ä¼ å‚</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"><span class="keyword">from</span> bossPro.items <span class="keyword">import</span> BossproItem</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BossSpider</span>(scrapy.Spider):</span><br><span class="line">    name = <span class="string">&#x27;boss&#x27;</span></span><br><span class="line">    <span class="comment"># allowed_domains = [&#x27;www.xxx.com&#x27;]</span></span><br><span class="line">    start_urls = [<span class="string">&#x27;https://www.zhipin.com/job_detail/?query=python&amp;city=101010100&amp;industry=&amp;position=&#x27;</span>]</span><br><span class="line">    url = <span class="string">&#x27;https://www.zhipin.com/c101010100/?query=python&amp;page=%d&#x27;</span></span><br><span class="line">    page_num = <span class="number">2</span></span><br><span class="line">   <span class="comment">#å›è°ƒå‡½æ•°æ¥å—item</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse_detail</span>(<span class="params">self,response</span>):</span><br><span class="line">        item = response.meta[<span class="string">&#x27;item&#x27;</span>]</span><br><span class="line">        job_desc = response.xpath(<span class="string">&#x27;//*[@id=&quot;main&quot;]/div[3]/div/div[2]/div[2]/div[1]/div//text()&#x27;</span>).extract()</span><br><span class="line">        job_desc = <span class="string">&#x27;&#x27;</span>.join(job_desc)</span><br><span class="line">        <span class="comment"># print(job_desc)</span></span><br><span class="line">        item[<span class="string">&#x27;job_desc&#x27;</span>] = job_desc</span><br><span class="line">        <span class="keyword">yield</span> item</span><br><span class="line">    <span class="comment">#è§£æé¦–é¡µä¸­çš„å²—ä½åç§°</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse</span>(<span class="params">self, response</span>):</span><br><span class="line">        li_list = response.xpath(<span class="string">&#x27;//*[@id=&quot;main&quot;]/div/div[3]/ul/li&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> li <span class="keyword">in</span> li_list:</span><br><span class="line">            item = BossproItem()</span><br><span class="line">            job_name = li.xpath(<span class="string">&#x27;.//div[@class=&quot;info-primary&quot;]/h3/a/div[1]/text()&#x27;</span>).extract_first()</span><br><span class="line">            item[<span class="string">&#x27;job_name&#x27;</span>] = job_name</span><br><span class="line">            <span class="comment"># print(job_name)</span></span><br><span class="line">            detail_url = <span class="string">&#x27;https://www.zhipin.com&#x27;</span>+li.xpath(<span class="string">&#x27;.//div[@class=&quot;info-primary&quot;]/h3/a/@href&#x27;</span>).extract_first()</span><br><span class="line">            <span class="comment">#å¯¹è¯¦æƒ…é¡µå‘è¯·æ±‚è·å–è¯¦æƒ…é¡µçš„é¡µé¢æºç æ•°æ®</span></span><br><span class="line">            <span class="comment">#æ‰‹åŠ¨è¯·æ±‚çš„å‘é€</span></span><br><span class="line">            <span class="comment">#è¯·æ±‚ä¼ å‚ï¼šmeta=&#123;&#125;ï¼Œå¯ä»¥å°†metaå­—å…¸ä¼ é€’ç»™è¯·æ±‚å¯¹åº”çš„å›è°ƒå‡½æ•°</span></span><br><span class="line">            <span class="keyword">yield</span> scrapy.Request(detail_url,callback=<span class="variable language_">self</span>.parse_detail,meta=&#123;<span class="string">&#x27;item&#x27;</span>:item&#125;)</span><br><span class="line">        <span class="comment">#åˆ†é¡µæ“ä½œ</span></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.page_num &lt;= <span class="number">3</span>:</span><br><span class="line">            new_url = <span class="built_in">format</span>(<span class="variable language_">self</span>.url%<span class="variable language_">self</span>.page_num)</span><br><span class="line">            <span class="variable language_">self</span>.page_num += <span class="number">1</span></span><br><span class="line">            <span class="keyword">yield</span> scrapy.Request(new_url,callback=<span class="variable language_">self</span>.parse)</span><br></pre></td></tr></table></figure>

<ul>
<li>å¢åŠ å¹¶å‘ï¼š<ul>
<li>é»˜è®¤scrapyå¼€å¯çš„å¹¶å‘çº¿ç¨‹ä¸º32ä¸ªï¼Œå¯ä»¥é€‚å½“è¿›è¡Œå¢åŠ ã€‚åœ¨settingsé…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹CONCURRENT_REQUESTS &#x3D; 100å€¼ä¸º100,å¹¶å‘è®¾ç½®æˆäº†ä¸º100ã€‚</li>
</ul>
</li>
<li>é™ä½æ—¥å¿—çº§åˆ«ï¼š<ul>
<li>åœ¨è¿è¡Œscrapyæ—¶ï¼Œä¼šæœ‰å¤§é‡æ—¥å¿—ä¿¡æ¯çš„è¾“å‡ºï¼Œä¸ºäº†å‡å°‘CPUçš„ä½¿ç”¨ç‡ã€‚å¯ä»¥è®¾ç½®logè¾“å‡ºä¿¡æ¯ä¸ºINFOæˆ–è€…ERRORå³å¯ã€‚åœ¨é…ç½®æ–‡ä»¶ä¸­ç¼–å†™ï¼šLOG_LEVEL &#x3D; â€˜INFOâ€™</li>
</ul>
</li>
<li>ç¦æ­¢cookieï¼š<ul>
<li>å¦‚æœä¸æ˜¯çœŸçš„éœ€è¦cookieï¼Œåˆ™åœ¨scrapyçˆ¬å–æ•°æ®æ—¶å¯ä»¥ç¦æ­¢cookieä»è€Œå‡å°‘CPUçš„ä½¿ç”¨ç‡ï¼Œæå‡çˆ¬å–æ•ˆç‡ã€‚åœ¨é…ç½®æ–‡ä»¶ä¸­ç¼–å†™ï¼šCOOKIES_ENABLED &#x3D; False</li>
</ul>
</li>
<li>ç¦æ­¢é‡è¯•ï¼š<ul>
<li>å¯¹å¤±è´¥çš„HTTPè¿›è¡Œé‡æ–°è¯·æ±‚ï¼ˆé‡è¯•ï¼‰ä¼šå‡æ…¢çˆ¬å–é€Ÿåº¦ï¼Œå› æ­¤å¯ä»¥ç¦æ­¢é‡è¯•ã€‚åœ¨é…ç½®æ–‡ä»¶ä¸­ç¼–å†™ï¼šRETRY_ENABLED &#x3D; False</li>
</ul>
</li>
<li>å‡å°‘ä¸‹è½½è¶…æ—¶ï¼š<ul>
<li>å¦‚æœå¯¹ä¸€ä¸ªéå¸¸æ…¢çš„é“¾æ¥è¿›è¡Œçˆ¬å–ï¼Œå‡å°‘ä¸‹è½½è¶…æ—¶å¯ä»¥èƒ½è®©å¡ä½çš„é“¾æ¥å¿«é€Ÿè¢«æ”¾å¼ƒï¼Œä»è€Œæå‡æ•ˆç‡ã€‚åœ¨é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œç¼–å†™ï¼šDOWNLOAD_TIMEOUT &#x3D; 10 è¶…æ—¶æ—¶é—´ä¸º10s</li>
</ul>
</li>
</ul>
<h3 id="å›¾ç‰‡æ•°æ®çˆ¬å–"><a href="#å›¾ç‰‡æ•°æ®çˆ¬å–" class="headerlink" title="å›¾ç‰‡æ•°æ®çˆ¬å–"></a>å›¾ç‰‡æ•°æ®çˆ¬å–</h3><ul>
<li>åœ¨scrapyä¸­æˆ‘ä»¬ä¹‹å‰çˆ¬å–çš„éƒ½æ˜¯åŸºäºå­—ç¬¦ä¸²ç±»å‹çš„æ•°æ®ï¼Œé‚£ä¹ˆè¦æ˜¯åŸºäºå›¾ç‰‡æ•°æ®çš„çˆ¬å–ï¼Œé‚£åˆè¯¥å¦‚ä½•å‘¢ï¼Ÿ<ul>
<li>å…¶å®åœ¨scrapyä¸­å·²ç»ä¸ºæˆ‘ä»¬å°è£…å¥½äº†ä¸€ä¸ªä¸“é—¨åŸºäºå›¾ç‰‡è¯·æ±‚å’ŒæŒä¹…åŒ–å­˜å‚¨çš„ç®¡é“ç±»ImagesPipelineï¼Œé‚£ä¹Ÿå°±æ˜¯è¯´å¦‚æœæƒ³è¦åŸºäºscrapyå®ç°å›¾ç‰‡æ•°æ®çš„çˆ¬å–ï¼Œåˆ™å¯ä»¥ç›´æ¥ä½¿ç”¨è¯¥ç®¡é“ç±»å³å¯ã€‚</li>
</ul>
</li>
<li>ImagesPipelineä½¿ç”¨æµç¨‹<ul>
<li>åœ¨é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œå¦‚ä¸‹é…ç½®ï¼š<br>IMAGES_STORE &#x3D; â€˜.&#x2F;imgsâ€™ï¼šè¡¨ç¤ºæœ€ç»ˆå›¾ç‰‡å­˜å‚¨çš„ç›®å½•</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pipline.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> scrapy.pipelines.images <span class="keyword">import</span> ImagesPipeline</span><br><span class="line">  <span class="keyword">import</span> scrapy</span><br><span class="line">  <span class="keyword">class</span> <span class="title class_">ImgproPipeline</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">      item = <span class="literal">None</span></span><br><span class="line">      <span class="keyword">def</span> <span class="title function_">process_item</span>(<span class="params">self, item, spider</span>):</span><br><span class="line">          <span class="comment"># print(item)</span></span><br><span class="line">          <span class="keyword">return</span> item</span><br><span class="line">  <span class="comment">#ImagesPipelineä¸“é—¨ç”¨äºæ–‡ä»¶ä¸‹è½½çš„ç®¡é“ç±»ï¼Œä¸‹è½½è¿‡ç¨‹æ”¯æŒå¼‚æ­¥å’Œå¤šçº¿ç¨‹</span></span><br><span class="line">  <span class="keyword">class</span> <span class="title class_">ImgPipeLine</span>(<span class="title class_ inherited__">ImagesPipeline</span>):</span><br><span class="line">      <span class="comment">#å¯¹itemä¸­çš„å›¾ç‰‡è¿›è¡Œè¯·æ±‚æ“ä½œ</span></span><br><span class="line">      <span class="keyword">def</span> <span class="title function_">get_media_requests</span>(<span class="params">self, item, info</span>):</span><br><span class="line">          <span class="keyword">yield</span> scrapy.Request(item[<span class="string">&#x27;src&#x27;</span>])</span><br><span class="line">      <span class="comment">#å®šåˆ¶å›¾ç‰‡çš„åç§°</span></span><br><span class="line">      <span class="keyword">def</span> <span class="title function_">file_path</span>(<span class="params">self, request, response=<span class="literal">None</span>, info=<span class="literal">None</span></span>):</span><br><span class="line">          url = request.url</span><br><span class="line">          file_name = url.split(<span class="string">&#x27;/&#x27;</span>)[-<span class="number">1</span>]</span><br><span class="line">          <span class="keyword">return</span> file_name</span><br><span class="line">      <span class="keyword">def</span> <span class="title function_">item_completed</span>(<span class="params">self, results, item, info</span>):</span><br><span class="line">          <span class="keyword">return</span> item  <span class="comment">#è¯¥è¿”å›å€¼ä¼šä¼ é€’ç»™ä¸‹ä¸€ä¸ªå³å°†è¢«æ‰§è¡Œçš„ç®¡é“ç±»</span></span><br></pre></td></tr></table></figure>

<h3 id="seleniumçš„åº”ç”¨"><a href="#seleniumçš„åº”ç”¨" class="headerlink" title="seleniumçš„åº”ç”¨"></a>seleniumçš„åº”ç”¨</h3><ul>
<li><p>åœ¨é€šè¿‡scrapyæ¡†æ¶è¿›è¡ŒæŸäº›ç½‘ç«™æ•°æ®çˆ¬å–çš„æ—¶å€™ï¼Œå¾€å¾€ä¼šç¢°åˆ°é¡µé¢åŠ¨æ€æ•°æ®åŠ è½½çš„æƒ…å†µå‘ç”Ÿï¼Œå¦‚æœç›´æ¥ä½¿ç”¨scrapyå¯¹å…¶urlå‘è¯·æ±‚ï¼Œæ˜¯ç»å¯¹è·å–ä¸åˆ°é‚£éƒ¨åˆ†åŠ¨æ€åŠ è½½å‡ºæ¥çš„æ•°æ®å€¼ã€‚ä½†æ˜¯é€šè¿‡è§‚å¯Ÿæˆ‘ä»¬ä¼šå‘ç°ï¼Œé€šè¿‡æµè§ˆå™¨è¿›è¡Œurlè¯·æ±‚å‘é€åˆ™ä¼šåŠ è½½å‡ºå¯¹åº”çš„åŠ¨æ€åŠ è½½å‡ºçš„æ•°æ®ã€‚é‚£ä¹ˆå¦‚æœæˆ‘ä»¬æƒ³è¦åœ¨scrapyä¹Ÿè·å–åŠ¨æ€åŠ è½½å‡ºçš„æ•°æ®ï¼Œåˆ™å¿…é¡»ä½¿ç”¨seleniumåˆ›å»ºæµè§ˆå™¨å¯¹è±¡ï¼Œç„¶åé€šè¿‡è¯¥æµè§ˆå™¨å¯¹è±¡è¿›è¡Œè¯·æ±‚å‘é€ï¼Œè·å–åŠ¨æ€åŠ è½½çš„æ•°æ®å€¼ã€‚</p>
<h4 id="æ¡ˆä¾‹åˆ†æï¼š"><a href="#æ¡ˆä¾‹åˆ†æï¼š" class="headerlink" title="æ¡ˆä¾‹åˆ†æï¼š"></a>æ¡ˆä¾‹åˆ†æï¼š</h4></li>
<li><p>éœ€æ±‚ï¼šçˆ¬å–ç½‘æ˜“æ–°é—»çš„å›½å†…æ¿å—ä¸‹çš„æ–°é—»æ•°æ®</p>
</li>
<li><p>éœ€æ±‚åˆ†æï¼šå½“ç‚¹å‡»å›½å†…è¶…é“¾è¿›å…¥å›½å†…å¯¹åº”çš„é¡µé¢æ—¶ï¼Œä¼šå‘ç°å½“å‰é¡µé¢å±•ç¤ºçš„æ–°é—»æ•°æ®æ˜¯è¢«åŠ¨æ€åŠ è½½å‡ºæ¥çš„ï¼Œå¦‚æœç›´æ¥é€šè¿‡ç¨‹åºå¯¹urlè¿›è¡Œè¯·æ±‚ï¼Œæ˜¯è·å–ä¸åˆ°åŠ¨æ€åŠ è½½å‡ºçš„æ–°é—»æ•°æ®çš„ã€‚åˆ™å°±éœ€è¦æˆ‘ä»¬ä½¿ç”¨seleniumå®ä¾‹åŒ–ä¸€ä¸ªæµè§ˆå™¨å¯¹è±¡ï¼Œåœ¨è¯¥å¯¹è±¡ä¸­è¿›è¡Œurlçš„è¯·æ±‚ï¼Œè·å–åŠ¨æ€åŠ è½½çš„æ–°é—»æ•°æ®ã€‚</p>
<h4 id="seleniumåœ¨scrapyä¸­ä½¿ç”¨çš„åŸç†åˆ†æï¼š"><a href="#seleniumåœ¨scrapyä¸­ä½¿ç”¨çš„åŸç†åˆ†æï¼š" class="headerlink" title="seleniumåœ¨scrapyä¸­ä½¿ç”¨çš„åŸç†åˆ†æï¼š"></a>seleniumåœ¨scrapyä¸­ä½¿ç”¨çš„åŸç†åˆ†æï¼š</h4></li>
<li><p>å½“å¼•æ“å°†å›½å†…æ¿å—urlå¯¹åº”çš„è¯·æ±‚æäº¤ç»™ä¸‹è½½å™¨åï¼Œä¸‹è½½å™¨è¿›è¡Œç½‘é¡µæ•°æ®çš„ä¸‹è½½ï¼Œç„¶åå°†ä¸‹è½½åˆ°çš„é¡µé¢æ•°æ®ï¼Œå°è£…åˆ°responseä¸­ï¼Œæäº¤ç»™å¼•æ“ï¼Œå¼•æ“å°†responseåœ¨è½¬äº¤ç»™Spidersã€‚Spidersæ¥å—åˆ°çš„responseå¯¹è±¡ä¸­å­˜å‚¨çš„é¡µé¢æ•°æ®é‡Œæ˜¯æ²¡æœ‰åŠ¨æ€åŠ è½½çš„æ–°é—»æ•°æ®çš„ã€‚è¦æƒ³è·å–åŠ¨æ€åŠ è½½çš„æ–°é—»æ•°æ®ï¼Œåˆ™éœ€è¦åœ¨ä¸‹è½½ä¸­é—´ä»¶ä¸­å¯¹ä¸‹è½½å™¨æäº¤ç»™å¼•æ“çš„responseå“åº”å¯¹è±¡è¿›è¡Œæ‹¦æˆªï¼Œåˆ‡å¯¹å…¶å†…éƒ¨å­˜å‚¨çš„é¡µé¢æ•°æ®è¿›è¡Œç¯¡æ”¹ï¼Œä¿®æ”¹æˆæºå¸¦äº†åŠ¨æ€åŠ è½½å‡ºçš„æ–°é—»æ•°æ®ï¼Œç„¶åå°†è¢«ç¯¡æ”¹çš„responseå¯¹è±¡æœ€ç»ˆäº¤ç»™Spidersè¿›è¡Œè§£ææ“ä½œã€‚</p>
<h4 id="seleniumåœ¨scrapyä¸­çš„ä½¿ç”¨æµç¨‹ï¼š"><a href="#seleniumåœ¨scrapyä¸­çš„ä½¿ç”¨æµç¨‹ï¼š" class="headerlink" title="seleniumåœ¨scrapyä¸­çš„ä½¿ç”¨æµç¨‹ï¼š"></a>seleniumåœ¨scrapyä¸­çš„ä½¿ç”¨æµç¨‹ï¼š</h4></li>
<li><p>é‡å†™çˆ¬è™«æ–‡ä»¶çš„æ„é€ æ–¹æ³•ï¼Œåœ¨è¯¥æ–¹æ³•ä¸­ä½¿ç”¨seleniumå®ä¾‹åŒ–ä¸€ä¸ªæµè§ˆå™¨å¯¹è±¡ï¼ˆå› ä¸ºæµè§ˆå™¨å¯¹è±¡åªéœ€è¦è¢«å®ä¾‹åŒ–ä¸€æ¬¡ï¼‰</p>
</li>
<li><p>é‡å†™çˆ¬è™«æ–‡ä»¶çš„closed(self,spider)æ–¹æ³•ï¼Œåœ¨å…¶å†…éƒ¨å…³é—­æµè§ˆå™¨å¯¹è±¡ã€‚è¯¥æ–¹æ³•æ˜¯åœ¨çˆ¬è™«ç»“æŸæ—¶è¢«è°ƒç”¨</p>
</li>
<li><p>é‡å†™ä¸‹è½½ä¸­é—´ä»¶çš„process_responseæ–¹æ³•ï¼Œè®©è¯¥æ–¹æ³•å¯¹å“åº”å¯¹è±¡è¿›è¡Œæ‹¦æˆªï¼Œå¹¶ç¯¡æ”¹responseä¸­å­˜å‚¨çš„é¡µé¢æ•°æ®</p>
</li>
<li><p>åœ¨é…ç½®æ–‡ä»¶ä¸­å¼€å¯ä¸‹è½½ä¸­é—´ä»¶</p>
</li>
</ul>
</div>
    </div>

    <div class="post-meta">
        <i>
        
            <span>2021-01-26</span>
            
            
             
        
        </i>
    </div>
    <br>
    
    
        
            
    
            <div class="post-footer-pre-next">
                
                    <span>ä¸Šä¸€ç¯‡ï¼š<a href='/2021/02/20/ES6-11/'>ç¬”è®° | ES6-11æ–°ç‰¹æ€§</a></span>
                

                
                    <span class="post-footer-pre-next-last-span-right">ä¸‹ä¸€ç¯‡ï¼š<a href="/2021/01/11/SpringMVC/">ç¬”è®° | SpringMVC</a>
                    </span>
                
            </div>
    
        
    

    
        

     
</div>



                                      
                    
                    
                    <div class="footer">
    
        <span> 
             

            
                

            
        </span>
       
    
</div>



<!--è¿™æ˜¯æŒ‡ä¸€æ¡çº¿å¾€ä¸‹çš„å†…å®¹-->
<div class="footer-last">
    
            <span>Change And Challenge</span>
            
    
</div>


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>

    <!--ç›®å½•-->
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript" ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" type="text/javascript" ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tocify/1.9.0/javascripts/jquery.tocify.min.js" type="text/javascript" ></script>
        
<script src="/js/toc.js"></script>

    

    
<script src="/js/randomHeaderContent.js"></script>

    <!--å›åˆ°é¡¶éƒ¨æŒ‰é’®-->
    
        
<script src="/js/returnToTop.js"></script>

    

    
        
<script src="/js/returnToLastPage.js"></script>

    





<script src="/js/lightgallery/lightgallery.umd.min.js"></script>



<script src="/js/lightgallery/plugins/lg-thumbnail.umd.min.js"></script>



<script src="/js/lightgallery/plugins/lg-fullscreen.umd.min.js"></script>


<script src="/js/lightgallery/plugins/lg-autoplay.umd.min.js"></script>


<script src="/js/lightgallery/plugins/lg-zoom.umd.min.js"></script>


<script src="/js/lightgallery/plugins/lg-rotate.umd.min.js"></script>


<script src="/js/lightgallery/plugins/lg-paper.umd.min.js"></script>




<script type="text/javascript">
     
    if (typeof lightGallery !== "undefined") {
        var options1 = {
            selector: '.gallery-item',
            plugins: [lgThumbnail, lgFullscreen, lgAutoplay, lgZoom, lgRotate, lgPager], // å¯ç”¨æ’ä»¶
            thumbnail: true,          // æ˜¾ç¤ºç¼©ç•¥å›¾
            zoom: true,               // å¯ç”¨ç¼©æ”¾åŠŸ
            rotate: true,             // å¯ç”¨æ—‹è½¬åŠŸèƒ½èƒ½
            autoplay: true,        // å¯ç”¨è‡ªåŠ¨æ’­æ”¾åŠŸèƒ½
            fullScreen: true,      // å¯ç”¨å…¨å±åŠŸèƒ½
            pager: false, //é¡µç ,
            zoomFromOrigin: true,   // ä»åŸå§‹ä½ç½®ç¼©æ”¾
            actualSize: true,       // å¯ç”¨æŸ¥çœ‹å®é™…å¤§å°çš„åŠŸèƒ½
            enableZoomAfter: 300,    // å»¶è¿Ÿç¼©æ”¾ï¼Œç¡®ä¿å›¾ç‰‡åŠ è½½å®Œæˆåå¯ç¼©æ”¾
        };
        lightGallery(document.getElementsByClassName('.article-gallery')[0], options1); // ä¿®å¤é€‰æ‹©å™¨
    }
    
</script>


                </div>
            
            
                <!-- å›åˆ°é¡¶éƒ¨çš„æŒ‰é’®-->  
                <div class="progress-wrap shadow-drop-2-bottom">
                    <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
                        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/>
                    </svg>
                </div>
            
            
                <!-- è¿”å›çš„æŒ‰é’®-->  
                <div class="return-to-last-progress-wrap shadow-drop-2-bottom">
                    <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
                        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/>
                    </svg>
                </div>
            
    </body>
</html>